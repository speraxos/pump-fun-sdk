<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŸ¢</text></svg>">
<title>PumpFun Live â€” Real-Time Token Launches</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a0a;
    color: #e0e0e0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
    font-size: 13px;
    line-height: 1.5;
  }

  #header {
    background: #111;
    border-bottom: 1px solid #222;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  #header h1 { font-size: 16px; color: #00ff41; white-space: nowrap; }
  .status { font-size: 12px; color: #666; }
  .status.connected { color: #00ff41; }
  .status.error { color: #ff4141; }
  .status.warn { color: #ffcc00; }
  #header .controls {
    margin-left: auto;
    display: flex;
    gap: 8px;
    align-items: center;
  }
  button {
    background: #1a1a1a;
    border: 1px solid #333;
    color: #00ff41;
    padding: 6px 14px;
    cursor: pointer;
    font-family: inherit;
    font-size: 12px;
    border-radius: 3px;
  }
  button:hover { background: #252525; border-color: #00ff41; }
  button.active { background: #002200; border-color: #00ff41; }

  #stats {
    background: #0d0d0d;
    border-bottom: 1px solid #1a1a1a;
    padding: 6px 20px;
    font-size: 11px;
    color: #555;
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
  }
  #stats .val { color: #00ff41; }

  #log {
    padding: 12px 16px;
    max-height: calc(100vh - 110px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  /* â”€â”€ Token Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card {
    background: #111;
    border: 1px solid #1e1e1e;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    gap: 12px;
    animation: fadeIn 0.3s ease;
    transition: border-color 0.2s;
  }
  .card:hover { border-color: #333; }
  .card.has-github { border-left: 3px solid #00ff41; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card-img {
    width: 56px;
    height: 56px;
    border-radius: 8px;
    background: #1a1a1a;
    flex-shrink: 0;
    object-fit: cover;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #333;
    overflow: hidden;
  }
  .card-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
  }

  .card-body { flex: 1; min-width: 0; }

  .card-top {
    display: flex;
    align-items: baseline;
    gap: 8px;
    flex-wrap: wrap;
  }
  .token-name { color: #fff; font-weight: 700; font-size: 14px; }
  .token-ticker { color: #ffcc00; font-weight: 600; font-size: 13px; }
  .token-mcap { color: #00ff41; font-size: 12px; }
  .token-time { color: #444; font-size: 11px; margin-left: auto; white-space: nowrap; }

  .card-desc {
    color: #777;
    font-size: 12px;
    margin-top: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .card-links {
    display: flex;
    gap: 10px;
    margin-top: 6px;
    flex-wrap: wrap;
    align-items: center;
  }
  .card-links a, .card-links span {
    font-size: 11px;
    color: #4a9eff;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 3px;
  }
  .card-links a:hover { text-decoration: underline; color: #7ab8ff; }
  .link-label { color: #555; font-size: 11px; }
  .github-badge {
    background: #002200;
    color: #00ff41;
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 700;
  }

  .card-addr {
    font-size: 11px;
    color: #444;
    margin-top: 4px;
    font-family: 'Courier New', monospace;
  }
  .card-addr a { color: #4a9eff; text-decoration: none; }
  .card-addr a:hover { text-decoration: underline; }

  /* â”€â”€ System messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sys { color: #444; padding: 4px 0; font-size: 11px; font-family: monospace; }
  .sys.error { color: #ff4141; }
  .sys.warn { color: #ffcc00; }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #0a0a0a; }
  ::-webkit-scrollbar-thumb { background: #222; border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #333; }

  @media (max-width: 600px) {
    #header { flex-direction: column; align-items: flex-start; }
    #header .controls { margin-left: 0; width: 100%; }
    .card { flex-direction: column; gap: 8px; }
    .card-img { width: 44px; height: 44px; }
  }
</style>
</head>
<body>

<div id="header">
  <h1>âš¡ PumpFun Live</h1>
  <div class="status" id="status">â— Connecting...</div>
  <div class="controls">
    <button id="btn-pause">Pause</button>
    <button id="btn-clear">Clear</button>
  </div>
</div>

<div id="stats">
  <div>Tokens: <span class="val" id="s-total">0</span></div>
  <div>With GitHub: <span class="val" id="s-github">0</span></div>
  <div>Clients: <span class="val" id="s-clients">1</span></div>
  <div>Source: <span class="val" id="s-solana">â€¦</span></div>
  <div>Uptime: <span class="val" id="s-uptime">0s</span></div>
</div>

<div id="log"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PumpFun Live â€” connects to PumpFun WebSocket Relay server
// Token data from PumpFun API â€” name, ticker, image, socials, mcap
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MAX_LOG_ENTRIES = 300;

const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
const WS_URL = `${wsProtocol}//${location.host}/ws`;

let ws = null;
let paused = false;
let reconnectDelay = 1000;
let reconnectTimer = null;
let seenMints = new Set();

const $log = document.getElementById('log');
const $status = document.getElementById('status');
const $btnPause = document.getElementById('btn-pause');
const $btnClear = document.getElementById('btn-clear');

$btnPause.onclick = () => {
  paused = !paused;
  $btnPause.textContent = paused ? 'Resume' : 'Pause';
  $btnPause.classList.toggle('active', paused);
  sysLog(paused ? 'Paused â€” events still tracked' : 'Resumed');
};
$btnClear.onclick = () => { $log.innerHTML = ''; seenMints.clear(); };

function connect() {
  setStatus('â— Connecting...', 'warn');
  sysLog(`Connecting to relay...`);

  ws = new WebSocket(WS_URL);

  ws.onopen = () => {
    reconnectDelay = 1000;
    setStatus('â— Connected', 'connected');
    sysLog('Connected â€” streaming live token launches');
  };

  ws.onmessage = (evt) => {
    let msg;
    try { msg = JSON.parse(evt.data); } catch { return; }
    if (msg.type === 'token-launch') handleLaunch(msg);
    else if (msg.type === 'status') handleStatus(msg);
  };

  ws.onerror = () => setStatus('â— Error', 'error');

  ws.onclose = () => {
    ws = null;
    setStatus(`â— Reconnecting...`, 'error');
    reconnectTimer = setTimeout(connect, reconnectDelay);
    reconnectDelay = Math.min(reconnectDelay * 2, 30000);
  };
}

function handleLaunch(ev) {
  const key = ev.mint || ev.signature;
  if (seenMints.has(key)) return;
  seenMints.add(key);
  if (!paused) renderCard(ev);
  document.getElementById('s-total').textContent = seenMints.size;
}

function handleStatus(s) {
  document.getElementById('s-total').textContent = s.totalLaunches;
  document.getElementById('s-github').textContent = s.githubLaunches;
  document.getElementById('s-clients').textContent = s.clients;
  document.getElementById('s-solana').textContent = s.connected ? 'PumpFun API âœ“' : 'Connectingâ€¦';
  const m = Math.floor(s.uptime / 60);
  const sec = s.uptime % 60;
  document.getElementById('s-uptime').textContent = m > 0 ? `${m}m ${sec}s` : `${sec}s`;
  if (s.connected) setStatus('â— Live', 'connected');
}

function renderCard(info) {
  const div = document.createElement('div');
  div.className = 'card' + (info.hasGithub ? ' has-github' : '');

  const name = info.name || 'Unknown';
  const ticker = info.symbol || '???';
  const mcap = info.marketCapSol != null ? `${Number(info.marketCapSol).toFixed(2)} SOL` : '';
  const time = new Date(info.time).toLocaleTimeString();
  const desc = info.description || '';
  const mint = info.mint || '';
  const creator = info.creator || '';

  // Image
  const imgHtml = info.imageUri
    ? `<img src="${esc(info.imageUri)}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='ğŸª™'">`
    : 'ğŸª™';

  // Social links
  let links = '';
  if (mint) {
    links += `<a href="https://pump.fun/coin/${mint}" target="_blank">pump.fun</a>`;
    links += `<a href="https://solscan.io/token/${mint}" target="_blank">solscan</a>`;
  }
  if (info.website) links += `<a href="${esc(info.website)}" target="_blank">ğŸŒ website</a>`;
  if (info.twitter) links += `<a href="${esc(info.twitter.startsWith('http') ? info.twitter : 'https://x.com/' + info.twitter)}" target="_blank">ğ•</a>`;
  if (info.telegram) links += `<a href="${esc(info.telegram.startsWith('http') ? info.telegram : 'https://t.me/' + info.telegram)}" target="_blank">âœˆï¸ telegram</a>`;
  if (info.hasGithub && info.githubUrls && info.githubUrls.length > 0) {
    for (const u of info.githubUrls) {
      links += `<a href="${esc(u)}" target="_blank"><span class="github-badge">GitHub</span> ${esc(u.replace('https://github.com/',''))}</a>`;
    }
  }

  // Addresses
  let addrHtml = '';
  if (mint) {
    const shortMint = mint.slice(0, 6) + 'â€¦' + mint.slice(-4);
    addrHtml += `<span>mint: <a href="https://solscan.io/token/${mint}" target="_blank">${shortMint}</a></span>`;
  }
  if (creator) {
    const shortCreator = creator.slice(0, 4) + 'â€¦' + creator.slice(-4);
    addrHtml += ` &nbsp; <span>creator: <a href="https://solscan.io/account/${creator}" target="_blank">${shortCreator}</a></span>`;
  }

  div.innerHTML = `
    <div class="card-img">${imgHtml}</div>
    <div class="card-body">
      <div class="card-top">
        <span class="token-name">${esc(name)}</span>
        <span class="token-ticker">$${esc(ticker)}</span>
        ${mcap ? `<span class="token-mcap">${mcap}</span>` : ''}
        <span class="token-time">${time}</span>
      </div>
      ${desc ? `<div class="card-desc">${esc(desc)}</div>` : ''}
      ${links ? `<div class="card-links">${links}</div>` : ''}
      ${addrHtml ? `<div class="card-addr">${addrHtml}</div>` : ''}
    </div>
  `;

  $log.prepend(div);

  while ($log.children.length > MAX_LOG_ENTRIES) {
    $log.removeChild($log.lastChild);
  }
}

function sysLog(msg, level = '') {
  const div = document.createElement('div');
  div.className = 'sys' + (level ? ' ' + level : '');
  div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  $log.prepend(div);
}

function setStatus(text, cls) {
  $status.textContent = text;
  $status.className = 'status' + (cls ? ' ' + cls : '');
}

function esc(s) {
  const d = document.createElement('div');
  d.textContent = s || '';
  return d.innerHTML;
}

sysLog('PumpFun Live â€” connecting to relay server...');
connect();
</script>
</body>
</html>
