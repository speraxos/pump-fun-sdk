<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”‘</text></svg>">
<title>Solana Vanity Address Generator â€” Pump Fun SDK</title>
<meta name="description" content="Generate custom Solana vanity addresses in your browser. All keys generated client-side â€” nothing leaves your machine. Powered by Pump Fun SDK.">
<style>
  :root {
    --bg: #0a0a0a; --bg2: #111; --bg3: #1a1a1a; --border: #222;
    --green: #00ff41; --red: #ff4141; --yellow: #ffcc00; --blue: #4a9eff;
    --orange: #ff9900; --purple: #b366ff; --cyan: #00e5ff; --dim: #555; --text: #ccc;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--green); font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5; }

  /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #app { max-width: 900px; margin: 0 auto; padding: 20px; }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #header {
    background: var(--bg2); border: 1px solid var(--border); border-radius: 6px;
    padding: 16px 20px; margin-bottom: 16px;
    display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
  }
  #header h1 { font-size: 18px; white-space: nowrap; }
  #header h1 span { color: var(--dim); font-weight: normal; font-size: 13px; }
  .badge {
    background: #002200; border: 1px solid var(--green); color: var(--green);
    padding: 2px 8px; border-radius: 3px; font-size: 11px; white-space: nowrap;
  }
  .badge.warn { background: #220000; border-color: var(--red); color: var(--red); }

  /* â”€â”€ Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section {
    background: var(--bg2); border: 1px solid var(--border); border-radius: 6px;
    padding: 16px 20px; margin-bottom: 16px;
  }
  .section h2 { font-size: 14px; color: var(--green); margin-bottom: 12px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }

  /* â”€â”€ Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .form-row { display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap; align-items: flex-end; }
  .form-group { display: flex; flex-direction: column; gap: 4px; }
  .form-group label { font-size: 11px; color: var(--dim); text-transform: uppercase; letter-spacing: 0.5px; }
  input[type="text"], input[type="number"] {
    background: var(--bg3); border: 1px solid #333; color: var(--text);
    padding: 8px 12px; font-family: inherit; font-size: 13px; border-radius: 4px; width: 200px;
  }
  input:focus { outline: none; border-color: var(--green); }
  input.invalid { border-color: var(--red); }

  .checkbox-row { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
  .checkbox-row input[type="checkbox"] { accent-color: var(--green); }
  .checkbox-row label { font-size: 12px; color: var(--text); cursor: pointer; }

  button {
    background: var(--bg3); border: 1px solid #333; color: var(--green);
    padding: 8px 20px; cursor: pointer; font-family: inherit; font-size: 13px; border-radius: 4px;
    transition: all 0.15s;
  }
  button:hover { background: #252525; border-color: var(--green); }
  button.primary { background: #002200; border-color: var(--green); font-weight: bold; }
  button.primary:hover { background: #003300; }
  button.danger { color: var(--red); }
  button.danger:hover { border-color: var(--red); }
  button:disabled { opacity: 0.4; cursor: not-allowed; }

  /* â”€â”€ Estimate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .estimate {
    background: var(--bg3); border: 1px solid var(--border); border-radius: 4px;
    padding: 10px 14px; margin-top: 12px; font-size: 12px; color: var(--text);
  }
  .estimate .label { color: var(--dim); }
  .estimate .value { color: var(--yellow); font-weight: bold; }
  .estimate .warn { color: var(--red); }

  /* â”€â”€ Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .progress-bar-container {
    background: var(--bg3); border: 1px solid var(--border); border-radius: 4px;
    height: 24px; position: relative; overflow: hidden; margin: 12px 0;
  }
  .progress-bar {
    background: linear-gradient(90deg, #002200 0%, var(--green) 100%);
    height: 100%; width: 0%; transition: width 0.3s; min-width: 0;
  }
  .progress-text {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 11px; color: var(--text); white-space: nowrap; text-shadow: 0 0 4px #000;
  }

  .stats-row { display: flex; gap: 20px; flex-wrap: wrap; font-size: 12px; color: var(--text); margin: 8px 0; }
  .stats-row .stat .label { color: var(--dim); }
  .stats-row .stat .value { color: var(--cyan); }

  /* â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .result-card {
    background: var(--bg3); border: 1px solid var(--green); border-radius: 6px;
    padding: 16px; margin-top: 12px; position: relative;
  }
  .result-card.new { animation: glow 0.6s ease-out; }
  @keyframes glow {
    0% { box-shadow: 0 0 20px rgba(0, 255, 65, 0.4); }
    100% { box-shadow: none; }
  }
  .result-label { font-size: 11px; color: var(--dim); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
  .result-value {
    font-size: 14px; color: var(--green); word-break: break-all; cursor: pointer;
    padding: 6px 8px; background: var(--bg); border-radius: 3px; margin-bottom: 12px;
    border: 1px solid var(--border); position: relative;
  }
  .result-value:hover { border-color: var(--green); }
  .result-value .match { color: var(--yellow); font-weight: bold; text-decoration: underline; }
  .result-value .copy-hint {
    position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
    font-size: 10px; color: var(--dim); pointer-events: none;
  }
  .result-value.secret { color: var(--red); }
  .result-meta { font-size: 11px; color: var(--dim); margin-top: 8px; }
  .copied-toast {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    background: var(--green); color: #000; padding: 8px 20px;
    border-radius: 4px; font-size: 12px; font-weight: bold;
    opacity: 0; transition: opacity 0.3s; z-index: 100; pointer-events: none;
  }
  .copied-toast.show { opacity: 1; }

  /* â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .history-item {
    background: var(--bg3); border: 1px solid var(--border); border-radius: 4px;
    padding: 10px 14px; margin-bottom: 8px; font-size: 12px;
    display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;
  }
  .history-item .addr { color: var(--green); word-break: break-all; flex: 1; }
  .history-item .meta { color: var(--dim); white-space: nowrap; }
  .history-item .actions { display: flex; gap: 6px; }
  .history-item button { padding: 3px 10px; font-size: 11px; }

  /* â”€â”€ Security Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .security-banner {
    background: #0a1a0a; border: 1px solid #1a3a1a; border-radius: 6px;
    padding: 12px 16px; margin-bottom: 16px; font-size: 12px; color: var(--text);
    display: flex; align-items: flex-start; gap: 10px;
  }
  .security-banner .icon { font-size: 18px; flex-shrink: 0; }
  .security-banner strong { color: var(--green); }
  .security-banner a { color: var(--cyan); text-decoration: none; }
  .security-banner a:hover { text-decoration: underline; }

  /* â”€â”€ Base58 Reference â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .base58-ref { font-size: 11px; color: var(--dim); margin-top: 8px; word-break: break-all; }
  .base58-ref code { color: var(--text); background: var(--bg3); padding: 2px 4px; border-radius: 2px; }

  /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  footer {
    text-align: center; padding: 20px; font-size: 11px; color: var(--dim);
    border-top: 1px solid var(--border); margin-top: 20px;
  }
  footer a { color: var(--cyan); text-decoration: none; }
  footer a:hover { text-decoration: underline; }

  /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 600px) {
    #app { padding: 10px; }
    .form-row { flex-direction: column; }
    input[type="text"], input[type="number"] { width: 100%; }
    .stats-row { flex-direction: column; gap: 4px; }
  }

  /* â”€â”€ Worker count selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  select {
    background: var(--bg3); border: 1px solid #333; color: var(--text);
    padding: 8px 12px; font-family: inherit; font-size: 13px; border-radius: 4px;
  }
  select:focus { outline: none; border-color: var(--green); }
</style>
</head>
<body>
<div id="app">

  <!-- Header -->
  <div id="header">
    <h1>ğŸ”‘ Vanity Address Generator <span>â€” Pump Fun SDK</span></h1>
    <span class="badge">100% Client-Side</span>
    <span class="badge">No Network</span>
  </div>

  <!-- Security Banner -->
  <div class="security-banner">
    <span class="icon">ğŸ›¡ï¸</span>
    <div>
      <strong>All keys are generated in your browser.</strong> Nothing is sent over the network.
      Private keys never leave your machine. This page uses the Web Crypto API (<code>Ed25519</code>)
      for cryptographically secure key generation.
      <br>Source: <a href="https://github.com/nicholascwm/pump-fun-sdk" target="_blank">github.com/nicholascwm/pump-fun-sdk</a>
    </div>
  </div>

  <!-- Input Section -->
  <div class="section">
    <h2>âš™ï¸ Configuration</h2>
    <div class="form-row">
      <div class="form-group">
        <label>Prefix (address starts with)</label>
        <input type="text" id="prefix" placeholder="e.g. pump" maxlength="6" spellcheck="false" autocomplete="off">
      </div>
      <div class="form-group">
        <label>Suffix (address ends with)</label>
        <input type="text" id="suffix" placeholder="e.g. fun" maxlength="6" spellcheck="false" autocomplete="off">
      </div>
      <div class="form-group">
        <label>Workers</label>
        <select id="workers">
          <option value="1">1 thread</option>
          <option value="2">2 threads</option>
          <option value="4" selected>4 threads</option>
          <option value="8">8 threads</option>
          <option value="12">12 threads</option>
          <option value="16">16 threads</option>
        </select>
      </div>
    </div>
    <div class="checkbox-row">
      <input type="checkbox" id="ignoreCase">
      <label for="ignoreCase">Case-insensitive matching (faster, more results)</label>
    </div>
    <div class="form-row">
      <button id="btnStart" class="primary" onclick="startGeneration()">â–¶ Generate</button>
      <button id="btnStop" class="danger" onclick="stopGeneration()" disabled>â–  Stop</button>
      <button onclick="clearResults()">âœ• Clear History</button>
    </div>
    <div class="base58-ref">
      Valid Base58 characters: <code>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</code>
      <br>Not allowed: <code>0</code> (zero), <code>O</code> (uppercase O), <code>I</code> (uppercase I), <code>l</code> (lowercase L)
    </div>
    <div id="estimate" class="estimate" style="display:none;"></div>
  </div>

  <!-- Progress Section -->
  <div id="progressSection" class="section" style="display:none;">
    <h2>â³ Searching...</h2>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progressBar"></div>
      <div class="progress-text" id="progressText">0 attempts</div>
    </div>
    <div class="stats-row">
      <div class="stat"><span class="label">Attempts: </span><span class="value" id="statAttempts">0</span></div>
      <div class="stat"><span class="label">Speed: </span><span class="value" id="statRate">0</span><span class="label"> keys/sec</span></div>
      <div class="stat"><span class="label">Elapsed: </span><span class="value" id="statElapsed">0s</span></div>
      <div class="stat"><span class="label">Est. remaining: </span><span class="value" id="statEta">â€”</span></div>
    </div>
  </div>

  <!-- Result Section -->
  <div id="resultSection" class="section" style="display:none;">
    <h2>âœ… Match Found!</h2>
    <div id="resultCard" class="result-card new">
      <div class="result-label">Public Key (Address)</div>
      <div class="result-value" id="resultPublicKey" onclick="copyToClipboard(this.textContent.replace('ğŸ“‹ click to copy','').trim(), 'Public key')">
        <span class="copy-hint">ğŸ“‹ click to copy</span>
      </div>
      <div class="result-label">Private Key (Base58)</div>
      <div class="result-value secret" id="resultSecretKey" onclick="copyToClipboard(this.textContent.replace('ğŸ“‹ click to copy','').trim(), 'Secret key')">
        <span class="copy-hint">ğŸ“‹ click to copy</span>
      </div>
      <div class="result-label">Secret Key (JSON Array â€” for Solana CLI)</div>
      <div class="result-value secret" id="resultSecretArray" onclick="copyToClipboard(this.textContent.replace('ğŸ“‹ click to copy','').trim(), 'Secret key array')" style="font-size:11px;">
        <span class="copy-hint">ğŸ“‹ click to copy</span>
      </div>
      <div class="result-meta" id="resultMeta"></div>
    </div>
    <div style="margin-top:10px;">
      <button onclick="downloadKeypair()">ğŸ’¾ Download Keypair JSON</button>
    </div>
  </div>

  <!-- History Section -->
  <div class="section">
    <h2>ğŸ“œ History <span id="historyCount" style="color:var(--dim);font-weight:normal;font-size:12px;">(0)</span></h2>
    <div id="historyList"><div style="color:var(--dim);font-size:12px;">No addresses generated yet.</div></div>
  </div>

  <footer>
    <a href="https://github.com/nicholascwm/pump-fun-sdk" target="_blank">Pump Fun SDK</a> â€”
    <a href="index.html">Live Launches</a> Â·
    <a href="trades.html">Trades Dashboard</a>
    <br>Keys generated entirely in your browser using Web Crypto API. Zero server calls.
  </footer>
</div>

<!-- Copied Toast -->
<div class="copied-toast" id="copiedToast">Copied!</div>

<!-- Web Worker (inline) -->
<script id="workerSource" type="text/worker">
// â”€â”€â”€ Vanity Address Web Worker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Uses Web Crypto API Ed25519 to generate Solana keypairs entirely client-side.
// Falls back to tweetnacl if Ed25519 is not supported.

const BASE58_ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';

function base58Encode(bytes) {
  const digits = [0];
  for (const byte of bytes) {
    let carry = byte;
    for (let j = 0; j < digits.length; j++) {
      carry += digits[j] << 8;
      digits[j] = carry % 58;
      carry = (carry / 58) | 0;
    }
    while (carry > 0) {
      digits.push(carry % 58);
      carry = (carry / 58) | 0;
    }
  }
  // leading zeros
  for (const byte of bytes) {
    if (byte !== 0) break;
    digits.push(0);
  }
  return digits.reverse().map(d => BASE58_ALPHABET[d]).join('');
}

// â”€â”€â”€ Ed25519 via Web Crypto â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let useWebCrypto = false;

async function init() {
  // Test if Ed25519 is available in this environment
  try {
    const testKey = await crypto.subtle.generateKey('Ed25519', true, ['sign', 'verify']);
    useWebCrypto = true;
  } catch {
    useWebCrypto = false;
  }
  return useWebCrypto;
}

async function generateKeypairWebCrypto() {
  const keyPair = await crypto.subtle.generateKey('Ed25519', true, ['sign', 'verify']);
  const pubRaw = new Uint8Array(await crypto.subtle.exportKey('raw', keyPair.publicKey));
  const privPkcs8 = new Uint8Array(await crypto.subtle.exportKey('pkcs8', keyPair.privateKey));
  // PKCS8 Ed25519 private key: the raw 32-byte seed is at bytes 16..48
  const seed = privPkcs8.slice(16, 48);
  // Solana CLI keypair format: [seed(32) + pubkey(32)] = 64 bytes
  const fullSecret = new Uint8Array(64);
  fullSecret.set(seed, 0);
  fullSecret.set(pubRaw, 32);
  return { publicKey: pubRaw, secretKey: fullSecret, seed };
}

// â”€â”€â”€ Fallback: tweetnacl-style (via crypto.getRandomValues + sign) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// We import nacl via importScripts if Web Crypto Ed25519 not available
let nacl = null;

async function generateKeypairNacl() {
  if (!nacl) {
    importScripts('https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl-fast.min.js');
    nacl = self.nacl;
  }
  const kp = nacl.sign.keyPair();
  return { publicKey: kp.publicKey, secretKey: kp.secretKey, seed: kp.secretKey.slice(0, 32) };
}

async function generateKeypair() {
  return useWebCrypto ? generateKeypairWebCrypto() : generateKeypairNacl();
}

// â”€â”€â”€ Matching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function matches(address, prefix, suffix, ignoreCase) {
  const addr = ignoreCase ? address.toLowerCase() : address;
  if (prefix) {
    const p = ignoreCase ? prefix.toLowerCase() : prefix;
    if (!addr.startsWith(p)) return false;
  }
  if (suffix) {
    const s = ignoreCase ? suffix.toLowerCase() : suffix;
    if (!addr.endsWith(s)) return false;
  }
  return true;
}

// â”€â”€â”€ Main loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let running = false;

self.onmessage = async function(e) {
  const { type, prefix, suffix, ignoreCase, batchSize } = e.data;

  if (type === 'start') {
    running = true;

    // Init crypto
    const hasWebCrypto = await init();
    self.postMessage({ type: 'init', useWebCrypto: hasWebCrypto });

    let attempts = 0;
    const batch = batchSize || 100;
    const startTime = Date.now();

    while (running) {
      for (let i = 0; i < batch && running; i++) {
        const kp = await generateKeypair();
        const address = base58Encode(kp.publicKey);
        attempts++;

        if (matches(address, prefix, suffix, ignoreCase)) {
          const secretKeyB58 = base58Encode(kp.secretKey);
          self.postMessage({
            type: 'found',
            publicKey: address,
            secretKey: secretKeyB58,
            secretArray: Array.from(kp.secretKey),
            attempts,
            elapsed: Date.now() - startTime,
          });
          running = false;
          return;
        }
      }

      // Report progress
      self.postMessage({
        type: 'progress',
        attempts,
        elapsed: Date.now() - startTime,
      });

      // Yield to prevent blocking
      await new Promise(r => setTimeout(r, 0));
    }

    self.postMessage({ type: 'stopped', attempts, elapsed: Date.now() - startTime });

  } else if (type === 'stop') {
    running = false;
  }
};
</script>

<script>
// â”€â”€â”€ Vanity Generator UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE58 = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
const BASE58_SET = new Set(BASE58);
const INVALID_CHARS = { '0': 'zero', 'O': 'uppercase O', 'I': 'uppercase I', 'l': 'lowercase L' };

let workers = [];
let totalAttempts = 0;
let startTime = 0;
let estimatedAttempts = 0;
let history = [];
let lastResult = null;
let progressInterval = null;

// â”€â”€â”€ Validation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function isValidBase58(str) {
  for (const ch of str) {
    if (!BASE58_SET.has(ch)) return false;
  }
  return true;
}

function getInvalidChars(str) {
  const bad = [];
  for (const ch of str) {
    if (!BASE58_SET.has(ch)) {
      const hint = INVALID_CHARS[ch] || '';
      bad.push(hint ? `'${ch}' (${hint})` : `'${ch}'`);
    }
  }
  return bad;
}

function estimateDifficulty(prefix, suffix, ignoreCase) {
  let chars = ignoreCase ? 34 : 58; // case-insensitive collapses upper+lower
  let len = (prefix || '').length + (suffix || '').length;
  if (len === 0) return 1;
  return Math.pow(chars, len);
}

// â”€â”€â”€ Estimate display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateEstimate() {
  const prefix = document.getElementById('prefix').value.trim();
  const suffix = document.getElementById('suffix').value.trim();
  const ignoreCase = document.getElementById('ignoreCase').checked;
  const el = document.getElementById('estimate');

  // Validate
  let valid = true;
  const prefixInput = document.getElementById('prefix');
  const suffixInput = document.getElementById('suffix');

  if (prefix && !isValidBase58(prefix)) {
    prefixInput.classList.add('invalid');
    valid = false;
  } else {
    prefixInput.classList.remove('invalid');
  }
  if (suffix && !isValidBase58(suffix)) {
    suffixInput.classList.add('invalid');
    valid = false;
  } else {
    suffixInput.classList.remove('invalid');
  }

  if (!prefix && !suffix) {
    el.style.display = 'none';
    return;
  }

  const est = estimateDifficulty(prefix, suffix, ignoreCase);
  const workerCount = parseInt(document.getElementById('workers').value);
  const keysPerSec = 800 * workerCount; // rough browser estimate
  const estSeconds = est / keysPerSec;

  let timeStr;
  if (estSeconds < 1) timeStr = 'less than a second';
  else if (estSeconds < 60) timeStr = `~${Math.round(estSeconds)} seconds`;
  else if (estSeconds < 3600) timeStr = `~${Math.round(estSeconds / 60)} minutes`;
  else if (estSeconds < 86400) timeStr = `~${(estSeconds / 3600).toFixed(1)} hours`;
  else if (estSeconds < 86400 * 365) timeStr = `~${(estSeconds / 86400).toFixed(1)} days`;
  else timeStr = `~${(estSeconds / (86400 * 365)).toFixed(1)} years`;

  const totalLen = (prefix || '').length + (suffix || '').length;
  let difficulty = 'Easy';
  let diffClass = '';
  if (totalLen >= 5) { difficulty = 'âš ï¸ Very Hard'; diffClass = 'warn'; }
  else if (totalLen >= 4) { difficulty = 'âš ï¸ Hard'; diffClass = 'warn'; }
  else if (totalLen >= 3) { difficulty = 'Moderate'; }

  const errors = [...getInvalidChars(prefix), ...getInvalidChars(suffix)];

  el.style.display = 'block';
  el.innerHTML = errors.length > 0
    ? `<span class="warn">âŒ Invalid characters: ${errors.join(', ')}</span>`
    : `<span class="label">Difficulty:</span> <span class="value ${diffClass}">${difficulty}</span> Â· 
       <span class="label">Expected attempts:</span> <span class="value">${formatNum(est)}</span> Â· 
       <span class="label">Est. time (${workerCount} workers):</span> <span class="value">${timeStr}</span>`;
}

// â”€â”€â”€ Start / Stop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGeneration() {
  const prefix = document.getElementById('prefix').value.trim();
  const suffix = document.getElementById('suffix').value.trim();
  const ignoreCase = document.getElementById('ignoreCase').checked;
  const workerCount = parseInt(document.getElementById('workers').value);

  if (!prefix && !suffix) {
    alert('Enter a prefix and/or suffix to search for.');
    return;
  }

  // Validate
  const errors = [...getInvalidChars(prefix), ...getInvalidChars(suffix)];
  if (errors.length > 0) {
    alert('Invalid Base58 characters: ' + errors.join(', '));
    return;
  }

  // Warn on long patterns
  const totalLen = prefix.length + suffix.length;
  if (totalLen >= 5) {
    if (!confirm(`Pattern length ${totalLen} will take a very long time. Continue?`)) return;
  }

  // UI state
  document.getElementById('btnStart').disabled = true;
  document.getElementById('btnStop').disabled = false;
  document.getElementById('progressSection').style.display = '';
  document.getElementById('resultSection').style.display = 'none';
  document.getElementById('progressBar').style.width = '0%';
  document.getElementById('progressText').textContent = 'Starting workers...';

  totalAttempts = 0;
  startTime = Date.now();
  estimatedAttempts = estimateDifficulty(prefix, suffix, ignoreCase);
  lastResult = null;

  // Create worker blob
  const workerCode = document.getElementById('workerSource').textContent;
  const blob = new Blob([workerCode], { type: 'application/javascript' });
  const workerUrl = URL.createObjectURL(blob);

  // Spawn workers
  workers = [];
  for (let i = 0; i < workerCount; i++) {
    const w = new Worker(workerUrl);
    w.onmessage = handleWorkerMessage;
    w.postMessage({ type: 'start', prefix, suffix, ignoreCase, batchSize: 50 });
    workers.push(w);
  }

  // Progress update interval
  progressInterval = setInterval(updateProgress, 250);
}

function stopGeneration() {
  for (const w of workers) {
    w.postMessage({ type: 'stop' });
    setTimeout(() => w.terminate(), 500);
  }
  workers = [];
  if (progressInterval) clearInterval(progressInterval);
  progressInterval = null;

  document.getElementById('btnStart').disabled = false;
  document.getElementById('btnStop').disabled = true;
  document.getElementById('progressText').textContent = 'Stopped';
}

function handleWorkerMessage(e) {
  const { type } = e.data;

  if (type === 'progress') {
    totalAttempts += e.data.attempts;
    // Reset worker counter (workers send cumulative â€” we aggregate)
    // Actually workers send running total, but we have multiple workers.
    // We'll just track the latest from each worker.
  }

  if (type === 'found') {
    lastResult = e.data;
    // Stop all workers
    stopGeneration();
    showResult(e.data);
  }

  if (type === 'init') {
    // Could show which crypto backend is being used
  }
}

// Better tracking: each worker tracks its own total
let workerAttempts = {};

function startGeneration2() {
  // This is handled in startGeneration
}

// Patch: track per-worker attempts
const origStart = startGeneration;
startGeneration = function() {
  const prefix = document.getElementById('prefix').value.trim();
  const suffix = document.getElementById('suffix').value.trim();
  const ignoreCase = document.getElementById('ignoreCase').checked;
  const workerCount = parseInt(document.getElementById('workers').value);

  if (!prefix && !suffix) {
    alert('Enter a prefix and/or suffix to search for.');
    return;
  }

  const errors = [...getInvalidChars(prefix), ...getInvalidChars(suffix)];
  if (errors.length > 0) {
    alert('Invalid Base58 characters: ' + errors.join(', '));
    return;
  }

  const totalLen = prefix.length + suffix.length;
  if (totalLen >= 5) {
    if (!confirm(`Pattern length ${totalLen} may take a very long time. Continue?`)) return;
  }

  // UI state
  document.getElementById('btnStart').disabled = true;
  document.getElementById('btnStop').disabled = false;
  document.getElementById('progressSection').style.display = '';
  document.getElementById('resultSection').style.display = 'none';
  document.getElementById('progressBar').style.width = '0%';
  document.getElementById('progressText').textContent = 'Starting workers...';

  totalAttempts = 0;
  workerAttempts = {};
  startTime = Date.now();
  estimatedAttempts = estimateDifficulty(prefix, suffix, ignoreCase);
  lastResult = null;

  const workerCode = document.getElementById('workerSource').textContent;
  const blob = new Blob([workerCode], { type: 'application/javascript' });
  const workerUrl = URL.createObjectURL(blob);

  workers = [];
  for (let i = 0; i < workerCount; i++) {
    const w = new Worker(workerUrl);
    const workerId = i;
    w.onmessage = function(e) {
      const { type } = e.data;
      if (type === 'progress' || type === 'found' || type === 'stopped') {
        workerAttempts[workerId] = e.data.attempts;
      }
      if (type === 'found') {
        lastResult = e.data;
        stopGeneration();
        showResult(e.data);
      }
    };
    w.postMessage({ type: 'start', prefix, suffix, ignoreCase, batchSize: 50 });
    workers.push(w);
  }

  progressInterval = setInterval(updateProgress, 250);
};

function updateProgress() {
  // Sum all worker attempts
  totalAttempts = Object.values(workerAttempts).reduce((a, b) => a + b, 0);
  const elapsed = (Date.now() - startTime) / 1000;
  const rate = elapsed > 0 ? totalAttempts / elapsed : 0;
  const pct = Math.min((totalAttempts / estimatedAttempts) * 100, 99.9);

  document.getElementById('progressBar').style.width = pct + '%';
  document.getElementById('progressText').textContent = `${formatNum(totalAttempts)} attempts (${pct.toFixed(1)}%)`;
  document.getElementById('statAttempts').textContent = formatNum(totalAttempts);
  document.getElementById('statRate').textContent = formatNum(Math.round(rate));
  document.getElementById('statElapsed').textContent = formatDuration(elapsed);

  if (rate > 0) {
    const remaining = Math.max(0, estimatedAttempts - totalAttempts) / rate;
    document.getElementById('statEta').textContent = remaining < 1 ? '< 1s' : formatDuration(remaining);
  }
}

// â”€â”€â”€ Show Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResult(data) {
  const prefix = document.getElementById('prefix').value.trim();
  const suffix = document.getElementById('suffix').value.trim();

  document.getElementById('resultSection').style.display = '';
  const card = document.getElementById('resultCard');
  card.classList.remove('new');
  void card.offsetWidth; // trigger reflow
  card.classList.add('new');

  // Highlight matched portions
  let pubHtml = escapeHtml(data.publicKey);
  if (prefix) {
    pubHtml = `<span class="match">${escapeHtml(data.publicKey.slice(0, prefix.length))}</span>${escapeHtml(data.publicKey.slice(prefix.length))}`;
  }
  if (suffix) {
    const mainPart = prefix ? data.publicKey.slice(prefix.length) : data.publicKey;
    const mainLen = mainPart.length;
    const suffixStart = mainLen - suffix.length;
    const beforeSuffix = mainPart.slice(0, suffixStart);
    const matchedSuffix = mainPart.slice(suffixStart);
    const prefixHtml = prefix ? `<span class="match">${escapeHtml(data.publicKey.slice(0, prefix.length))}</span>` : '';
    pubHtml = `${prefixHtml}${escapeHtml(beforeSuffix)}<span class="match">${escapeHtml(matchedSuffix)}</span>`;
  }

  document.getElementById('resultPublicKey').innerHTML = pubHtml + '<span class="copy-hint">ğŸ“‹ click to copy</span>';
  document.getElementById('resultSecretKey').innerHTML = escapeHtml(data.secretKey) + '<span class="copy-hint">ğŸ“‹ click to copy</span>';
  document.getElementById('resultSecretArray').innerHTML = escapeHtml(JSON.stringify(data.secretArray)) + '<span class="copy-hint">ğŸ“‹ click to copy</span>';

  const elapsed = data.elapsed / 1000;
  const rate = data.attempts / elapsed;
  document.getElementById('resultMeta').textContent = 
    `Found in ${formatNum(data.attempts)} attempts Â· ${formatDuration(elapsed)} Â· ${formatNum(Math.round(rate))} keys/sec`;

  // Add to history
  addToHistory(data);

  // Update final progress
  document.getElementById('progressText').textContent = `âœ… Found in ${formatNum(data.attempts)} attempts`;
  document.getElementById('progressBar').style.width = '100%';
}

// â”€â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addToHistory(data) {
  history.unshift({
    publicKey: data.publicKey,
    secretKey: data.secretKey,
    secretArray: data.secretArray,
    attempts: data.attempts,
    elapsed: data.elapsed,
    prefix: document.getElementById('prefix').value.trim(),
    suffix: document.getElementById('suffix').value.trim(),
    timestamp: new Date().toISOString(),
  });
  renderHistory();
}

function renderHistory() {
  const el = document.getElementById('historyList');
  document.getElementById('historyCount').textContent = `(${history.length})`;
  if (history.length === 0) {
    el.innerHTML = '<div style="color:var(--dim);font-size:12px;">No addresses generated yet.</div>';
    return;
  }
  el.innerHTML = history.map((h, i) => {
    const pattern = [h.prefix ? `prefix:${h.prefix}` : '', h.suffix ? `suffix:${h.suffix}` : ''].filter(Boolean).join(' ');
    return `
      <div class="history-item">
        <span class="addr" title="${escapeHtml(h.publicKey)}">${escapeHtml(h.publicKey)}</span>
        <span class="meta">${pattern} Â· ${formatNum(h.attempts)} tries</span>
        <span class="actions">
          <button onclick="copyToClipboard('${escapeHtml(h.publicKey)}','Address')">ğŸ“‹</button>
          <button onclick="downloadHistoryKeypair(${i})">ğŸ’¾</button>
        </span>
      </div>`;
  }).join('');
}

function clearResults() {
  history = [];
  lastResult = null;
  renderHistory();
  document.getElementById('resultSection').style.display = 'none';
  document.getElementById('progressSection').style.display = 'none';
}

// â”€â”€â”€ Download / Copy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadKeypair() {
  if (!lastResult) return;
  downloadJSON(lastResult.secretArray, lastResult.publicKey);
}

function downloadHistoryKeypair(index) {
  const h = history[index];
  if (!h) return;
  downloadJSON(h.secretArray, h.publicKey);
}

function downloadJSON(secretArray, publicKey) {
  const json = JSON.stringify(secretArray);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${publicKey.slice(0, 8)}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function copyToClipboard(text, label) {
  navigator.clipboard.writeText(text).then(() => {
    const toast = document.getElementById('copiedToast');
    toast.textContent = `${label || 'Value'} copied!`;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 1500);
  });
}

// â”€â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatNum(n) {
  if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
  if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
  if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
  return n.toLocaleString();
}

function formatDuration(seconds) {
  if (seconds < 60) return Math.round(seconds) + 's';
  if (seconds < 3600) return Math.floor(seconds / 60) + 'm ' + Math.round(seconds % 60) + 's';
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  return h + 'h ' + m + 'm';
}

function escapeHtml(str) {
  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('prefix').addEventListener('input', updateEstimate);
document.getElementById('suffix').addEventListener('input', updateEstimate);
document.getElementById('ignoreCase').addEventListener('change', updateEstimate);
document.getElementById('workers').addEventListener('change', updateEstimate);

// Set default worker count based on hardware
const cores = navigator.hardwareConcurrency || 4;
const workerSelect = document.getElementById('workers');
const bestDefault = [1,2,4,8,12,16].filter(n => n <= Math.max(cores - 1, 1)).pop() || 4;
workerSelect.value = String(bestDefault);
</script>

</body>
</html>
