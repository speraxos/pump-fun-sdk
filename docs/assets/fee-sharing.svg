<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 300" fill="none">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f0f23" />
      <stop offset="100%" style="stop-color:#1a1a3e" />
    </linearGradient>
    <linearGradient id="solana" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#9945FF" />
      <stop offset="100%" style="stop-color:#14F195" />
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>

  <style>
    @keyframes flowRight { 0% { stroke-dashoffset: 20; } 100% { stroke-dashoffset: 0; } }
    @keyframes pulse { 0%,100% { opacity: 0.4; } 50% { opacity: 1; } }
    @keyframes fillUp { 0% { height: 0; y: 60; } 100% { height: 60; y: 0; } }
    @keyframes coinDrop {
      0% { transform: translateY(-8px); opacity: 0; }
      30% { transform: translateY(0); opacity: 1; }
      70% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(8px); opacity: 0; }
    }
    @keyframes shareGlow {
      0%,100% { stroke-opacity: 0.4; }
      50% { stroke-opacity: 1; }
    }
    @keyframes ripple {
      0% { r: 0; opacity: 0.5; }
      100% { r: 20; opacity: 0; }
    }
    .flow-r { stroke-dasharray: 6 4; animation: flowRight 0.8s linear infinite; }
    .pulse { animation: pulse 2s ease-in-out infinite; }
    .coin1 { animation: coinDrop 2s ease-in-out infinite; }
    .coin2 { animation: coinDrop 2s ease-in-out 0.4s infinite; }
    .coin3 { animation: coinDrop 2s ease-in-out 0.8s infinite; }
    .share-glow { animation: shareGlow 2s ease-in-out infinite; }
  </style>

  <!-- Background -->
  <rect width="800" height="300" rx="12" fill="url(#bg)"/>
  <rect x="0" y="0" width="800" height="2.5" rx="1" fill="url(#solana)" opacity="0.8"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-family="'SF Mono','Fira Code',monospace" font-size="18" font-weight="700" fill="url(#solana)" filter="url(#glow)">Fee Sharing</text>

  <!-- ========== Step 1: Trading generates fees ========== -->
  <g transform="translate(30, 55)">
    <rect x="0" y="0" width="140" height="90" rx="10" fill="#1e1e3f" stroke="#8b8bae" stroke-width="1"/>
    <text x="70" y="22" text-anchor="middle" font-family="monospace" font-size="10" font-weight="600" fill="#8b8bae">TRADES</text>

    <!-- Animated coins -->
    <g transform="translate(35, 30)">
      <circle cx="15" cy="15" r="6" fill="#9945FF" opacity="0.7" class="coin1"/>
      <text x="15" y="18" text-anchor="middle" font-family="monospace" font-size="6" fill="#fff" class="coin1">◎</text>
      <circle cx="40" cy="25" r="6" fill="#9945FF" opacity="0.7" class="coin2"/>
      <text x="40" y="28" text-anchor="middle" font-family="monospace" font-size="6" fill="#fff" class="coin2">◎</text>
      <circle cx="65" cy="15" r="6" fill="#9945FF" opacity="0.7" class="coin3"/>
      <text x="65" y="18" text-anchor="middle" font-family="monospace" font-size="6" fill="#fff" class="coin3">◎</text>
    </g>

    <text x="70" y="80" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#666">creatorFeeBps</text>
  </g>

  <!-- Arrow: trades → vault -->
  <line x1="175" y1="100" x2="220" y2="100" stroke="#9945FF" stroke-width="1.5" class="flow-r" opacity="0.6"/>
  <polygon points="220,96 228,100 220,104" fill="#9945FF" class="pulse"/>

  <!-- ========== Step 2: Creator Vault ========== -->
  <g transform="translate(235, 55)">
    <rect x="0" y="0" width="120" height="90" rx="10" fill="#1e1e3f" stroke="#9945FF" stroke-width="1.5"/>
    <text x="60" y="22" text-anchor="middle" font-family="monospace" font-size="10" font-weight="600" fill="#9945FF">CREATOR</text>
    <text x="60" y="36" text-anchor="middle" font-family="monospace" font-size="10" font-weight="600" fill="#9945FF">VAULT</text>

    <!-- Vault fill animation -->
    <rect x="25" y="48" width="70" height="32" rx="4" fill="#9945FF" opacity="0.1" stroke="#9945FF" stroke-width="0.5"/>
    <rect x="26" y="70" width="68" height="9" rx="3" fill="#9945FF" opacity="0.25">
      <animate attributeName="height" values="5;28;5" dur="4s" repeatCount="indefinite"/>
      <animate attributeName="y" values="73;50;73" dur="4s" repeatCount="indefinite"/>
    </rect>

    <text x="60" y="88" text-anchor="middle" font-family="sans-serif" font-size="7" fill="#666">creatorVaultPda</text>
  </g>

  <!-- For graduated tokens: AMM vault merges in -->
  <g transform="translate(235, 150)" opacity="0.7">
    <rect x="0" y="0" width="120" height="40" rx="6" fill="#1e1e3f" stroke="#E8590C" stroke-width="1" stroke-dasharray="3 2"/>
    <text x="60" y="16" text-anchor="middle" font-family="monospace" font-size="8" font-weight="600" fill="#E8590C">AMM VAULT</text>
    <text x="60" y="30" text-anchor="middle" font-family="sans-serif" font-size="7" fill="#666">ammCreatorVaultPda</text>
    <!-- Arrow up to merge -->
    <line x1="60" y1="0" x2="60" y2="-5" stroke="#E8590C" stroke-width="1" class="flow-r" opacity="0.6"/>
    <text x="130" y="20" font-family="sans-serif" font-size="7" fill="#E8590C">↑ auto-consolidate</text>
    <text x="130" y="32" font-family="sans-serif" font-size="7" fill="#666">if graduated</text>
  </g>

  <!-- Arrow: vault → sharing config -->
  <line x1="360" y1="100" x2="405" y2="100" stroke="#9945FF" stroke-width="1.5" class="flow-r" opacity="0.6"/>
  <polygon points="405,96 413,100 405,104" fill="#9945FF" class="pulse"/>

  <!-- ========== Step 3: Sharing Config ========== -->
  <g transform="translate(420, 50)">
    <rect x="0" y="0" width="130" height="100" rx="10" fill="#1e1e3f" stroke="url(#solana)" stroke-width="1.5" class="share-glow"/>
    <text x="65" y="20" text-anchor="middle" font-family="monospace" font-size="10" font-weight="600" fill="url(#solana)">FEE SHARING</text>
    <text x="65" y="34" text-anchor="middle" font-family="monospace" font-size="10" font-weight="600" fill="url(#solana)">CONFIG</text>

    <!-- Shares visualization -->
    <g transform="translate(10, 42)">
      <rect x="0" y="0" width="110" height="12" rx="3" fill="#333"/>
      <rect x="0" y="0" width="55" height="12" rx="3" fill="#9945FF" opacity="0.5"/>
      <rect x="55" y="0" width="33" height="12" rx="3" fill="#14F195" opacity="0.5"/>
      <rect x="88" y="0" width="22" height="12" rx="3" fill="#E8590C" opacity="0.5"/>
      <text x="27" y="9" text-anchor="middle" font-family="monospace" font-size="6" fill="#fff">50%</text>
      <text x="71" y="9" text-anchor="middle" font-family="monospace" font-size="6" fill="#fff">30%</text>
      <text x="99" y="9" text-anchor="middle" font-family="monospace" font-size="6" fill="#fff">20%</text>
    </g>

    <text x="65" y="70" text-anchor="middle" font-family="sans-serif" font-size="7" fill="#666">sum = 10,000 bps</text>
    <text x="65" y="82" text-anchor="middle" font-family="sans-serif" font-size="7" fill="#666">max 10 shareholders</text>
    <text x="65" y="94" text-anchor="middle" font-family="sans-serif" font-size="7" fill="#666">feeSharingConfigPda</text>
  </g>

  <!-- Arrow: config → shareholders -->
  <line x1="555" y1="85" x2="590" y2="65" stroke="#9945FF" stroke-width="1" class="flow-r" opacity="0.6"/>
  <line x1="555" y1="100" x2="590" y2="100" stroke="#14F195" stroke-width="1" class="flow-r" opacity="0.6"/>
  <line x1="555" y1="115" x2="590" y2="135" stroke="#E8590C" stroke-width="1" class="flow-r" opacity="0.6"/>

  <!-- ========== Step 4: Shareholders ========== -->
  <!-- Shareholder A -->
  <g transform="translate(600, 45)">
    <rect x="0" y="0" width="100" height="35" rx="6" fill="#1e1e3f" stroke="#9945FF" stroke-width="1"/>
    <text x="50" y="15" text-anchor="middle" font-family="monospace" font-size="9" font-weight="600" fill="#9945FF">Wallet A</text>
    <text x="50" y="28" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#8b8bae">5,000 bps</text>
    <circle cx="95" cy="8" r="3" fill="#9945FF" class="pulse"/>
  </g>

  <!-- Shareholder B -->
  <g transform="translate(600, 85)">
    <rect x="0" y="0" width="100" height="35" rx="6" fill="#1e1e3f" stroke="#14F195" stroke-width="1"/>
    <text x="50" y="15" text-anchor="middle" font-family="monospace" font-size="9" font-weight="600" fill="#14F195">Wallet B</text>
    <text x="50" y="28" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#8b8bae">3,000 bps</text>
    <circle cx="95" cy="8" r="3" fill="#14F195" class="pulse"/>
  </g>

  <!-- Shareholder C -->
  <g transform="translate(600, 125)">
    <rect x="0" y="0" width="100" height="35" rx="6" fill="#1e1e3f" stroke="#E8590C" stroke-width="1"/>
    <text x="50" y="15" text-anchor="middle" font-family="monospace" font-size="9" font-weight="600" fill="#E8590C">Wallet C</text>
    <text x="50" y="28" text-anchor="middle" font-family="sans-serif" font-size="8" fill="#8b8bae">2,000 bps</text>
    <circle cx="95" cy="8" r="3" fill="#E8590C" class="pulse"/>
  </g>

  <!-- ========== Bottom: API call flow ========== -->
  <g transform="translate(30, 210)">
    <rect x="0" y="0" width="740" height="70" rx="10" fill="#12122a" stroke="#333" stroke-width="0.5"/>

    <!-- Step badges -->
    <g transform="translate(15, 15)">
      <circle cx="8" cy="8" r="8" fill="#9945FF" opacity="0.8"/>
      <text x="8" y="11" text-anchor="middle" font-family="monospace" font-size="8" font-weight="700" fill="#fff">1</text>
      <text x="22" y="12" font-family="'SF Mono',monospace" font-size="8" fill="#9945FF">createFeeSharingConfig</text>

      <line x1="155" y1="8" x2="170" y2="8" stroke="#444" stroke-width="1"/>
      <polygon points="170,5 176,8 170,11" fill="#444"/>

      <circle cx="185" cy="8" r="8" fill="#14F195" opacity="0.8"/>
      <text x="185" y="11" text-anchor="middle" font-family="monospace" font-size="8" font-weight="700" fill="#0f0f23">2</text>
      <text x="199" y="12" font-family="'SF Mono',monospace" font-size="8" fill="#14F195">updateFeeShares</text>

      <line x1="305" y1="8" x2="320" y2="8" stroke="#444" stroke-width="1"/>
      <polygon points="320,5 326,8 320,11" fill="#444"/>

      <circle cx="335" cy="8" r="8" fill="#E8590C" opacity="0.8"/>
      <text x="335" y="11" text-anchor="middle" font-family="monospace" font-size="8" font-weight="700" fill="#fff">3</text>
      <text x="349" y="12" font-family="'SF Mono',monospace" font-size="8" fill="#E8590C">getMinimumDistributableFee</text>

      <line x1="520" y1="8" x2="535" y2="8" stroke="#444" stroke-width="1"/>
      <polygon points="535,5 541,8 535,11" fill="#444"/>

      <circle cx="550" cy="8" r="8" fill="url(#solana)" opacity="0.8"/>
      <text x="550" y="11" text-anchor="middle" font-family="monospace" font-size="8" font-weight="700" fill="#fff">4</text>
      <text x="564" y="12" font-family="'SF Mono',monospace" font-size="8" fill="url(#solana)">distributeCreatorFees</text>
    </g>

    <text x="30" y="50" font-family="sans-serif" font-size="8" fill="#666">Validation: no dupes · no zero shares · sum = 10,000 bps · max 10 shareholders · pool required if graduated</text>
    <text x="30" y="62" font-family="sans-serif" font-size="8" fill="#666">Errors: NoShareholdersError · TooManyShareholdersError · ZeroShareError · InvalidShareTotalError · DuplicateShareholderError</text>
  </g>

  <!-- Bottom accent -->
  <rect x="0" y="297.5" width="800" height="2.5" rx="1" fill="url(#solana)" opacity="0.8"/>
</svg>
