<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“ˆ</text></svg>">
<title>pump-sdk â€” Tweet Ã— Price</title>
<meta name="description" content="pump-sdk token price with @nichxbt tweet markers. See how tweets correlate with price action on Solana.">
<script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
  :root {
    --bg: #0D0C0B; --surface1: #0F0F12; --surface2: #161619;
    --text: #FAFAFA; --muted: #71717A; --secondary: #A1A1AA;
    --green: #22c55e; --red: #ef4444; --blue: #3b82f6; --yellow: #f59e0b;
    --border: rgba(255,255,255,0.08);
    --positive: #22C55E; --negative: #EF4444;
    --candle-up: rgba(94,186,162,0.35); --candle-down: rgba(216,126,136,0.35);
    --candle-border-up: rgba(94,186,162,0.48); --candle-border-down: rgba(216,126,136,0.48);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif; overflow: hidden; }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #header {
    background: var(--surface1); border-bottom: 1px solid var(--border);
    padding: 8px 16px; display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
    height: 48px;
  }
  .token-info { display: flex; align-items: center; gap: 8px; }
  .token-icon { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border); }
  .token-name { font-weight: 700; font-size: 15px; }
  .token-pair { color: var(--muted); font-size: 11px; }
  #live-price { font-size: 18px; font-weight: 700; font-family: 'SF Mono','Fira Code',monospace; }
  #live-price.up { color: var(--green); }
  #live-price.down { color: var(--red); }
  #price-change { font-size: 11px; padding: 2px 8px; border-radius: 5px; font-weight: 600; }
  #price-change.up { background: rgba(34,197,94,0.12); color: var(--green); }
  #price-change.down { background: rgba(239,68,68,0.12); color: var(--red); }
  .header-right { display: flex; gap: 14px; margin-left: auto; align-items: center; }
  .stat { display: flex; flex-direction: column; gap: 0; }
  .stat-label { font-size: 8px; text-transform: uppercase; letter-spacing: 0.4px; color: var(--muted); }
  .stat-value { font-size: 11px; font-family: monospace; }
  .links { display: flex; gap: 4px; }
  .links a { color: var(--muted); text-decoration: none; font-size: 10px; padding: 2px 8px; border: 1px solid var(--border); border-radius: 5px; transition: all 0.15s; }
  .links a:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }
  .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.3} }

  /* â”€â”€ Chart area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #chart-area { position: relative; width: 100%; }
  #chart-container { width: 100%; height: 100%; }
  #markers-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }

  /* â”€â”€ Controls overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #controls {
    position: absolute; top: 8px; left: 8px; z-index: 20;
    display: flex; align-items: center; gap: 4px;
  }
  .ctrl-btn {
    background: var(--surface1); border: 1px solid var(--border); color: var(--muted);
    padding: 4px 12px; font-size: 11px; font-family: inherit; cursor: pointer;
    border-radius: 5px; transition: all 0.15s; font-weight: 500;
  }
  .ctrl-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }
  .ctrl-btn.active { color: var(--text); background: var(--blue); border-color: var(--blue); }
  .ctrl-sep { width: 1px; height: 18px; background: var(--border); margin: 0 4px; }
  #tweet-toggle { display: flex; align-items: center; gap: 5px; cursor: pointer; }
  #tweet-toggle .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--blue); box-shadow: 0 0 6px rgba(59,130,246,0.5); transition: all 0.15s; }
  #tweet-toggle.off .dot { background: var(--muted); box-shadow: none; }
  #tweet-count { background: var(--surface2); color: var(--secondary); padding: 1px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; }

  /* â”€â”€ Legend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #legend {
    position: absolute; bottom: 8px; right: 8px; z-index: 20;
    display: flex; align-items: center; gap: 10px;
    background: rgba(15,15,18,0.9); padding: 4px 10px; border-radius: 6px;
    font-size: 9px; color: var(--secondary);
  }
  .legend-item { display: flex; align-items: center; gap: 4px; }
  .legend-circle { width: 10px; height: 10px; border-radius: 50%; border: 1.5px solid rgba(255,255,255,0.5); }
  .legend-line { width: 14px; border-top: 1.5px dashed var(--negative); }

  /* â”€â”€ Tooltip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #tweet-tooltip {
    position: fixed; background: var(--surface1); border: 1px solid var(--border);
    border-radius: 10px; padding: 10px 14px; max-width: 320px; z-index: 100;
    pointer-events: none; opacity: 0; transition: opacity 0.12s;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5); font-size: 12px; line-height: 1.45;
  }
  #tweet-tooltip.visible { opacity: 1; }
  .tt-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
  .tt-avatar { width: 28px; height: 28px; border-radius: 50%; background: var(--surface2); }
  .tt-name { font-weight: 600; font-size: 12px; }
  .tt-time { color: var(--muted); font-size: 10px; }
  .tt-text { color: var(--secondary); margin-bottom: 6px; word-wrap: break-word; }
  .tt-stats { display: flex; gap: 10px; color: var(--muted); font-size: 10px; }

  /* â”€â”€ Help â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #help-text { position: absolute; bottom: 8px; left: 8px; z-index: 20; font-size: 9px; color: #52525B; user-select: none; }

  /* â”€â”€ Tweet Feed Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #feed-panel {
    position: fixed; top: 48px; right: 0; bottom: 0; width: 380px;
    background: var(--surface1); border-left: 1px solid var(--border);
    z-index: 50; transform: translateX(100%); transition: transform 0.25s ease;
    display: flex; flex-direction: column;
  }
  #feed-panel.open { transform: translateX(0); }
  #feed-header {
    padding: 10px 14px; border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 8px; flex-shrink: 0;
  }
  #feed-header .nich-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--blue); }
  #feed-header .nich-name { font-weight: 700; font-size: 13px; }
  #feed-header .nich-handle { color: var(--muted); font-size: 11px; }
  #feed-close {
    margin-left: auto; background: none; border: 1px solid var(--border);
    color: var(--muted); width: 28px; height: 28px; border-radius: 5px;
    cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }
  #feed-close:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }
  #feed-body { flex: 1; overflow-y: auto; }
  #feed-body .timeline-placeholder {
    padding: 20px; text-align: center; color: var(--muted); font-size: 12px;
  }
  /* Feed toggle button in controls */
  .feed-btn { position: relative; }
  .feed-btn .feed-dot {
    width: 7px; height: 7px; border-radius: 50%; background: #1DA1F2;
    box-shadow: 0 0 6px rgba(29,161,242,0.5); display: inline-block;
  }
  .feed-btn.off .feed-dot { background: var(--muted); box-shadow: none; }
  /* Nich avatar in header */
  .nich-header-avatar { width: 24px; height: 24px; border-radius: 50%; border: 1.5px solid var(--blue); margin-left: 4px; }

  @media (max-width: 768px) {
    .header-right .stat { display: none; }
    .links { display: none; }
    #legend { display: none; }
    #feed-panel { width: 100%; }
  }
</style>
</head>
<body>

<!-- Header -->
<div id="header">
  <div class="token-info">
    <img class="token-icon" id="token-icon" src="" alt="pump-sdk" onerror="this.style.display='none'">
    <span class="token-name">pump-sdk</span>
    <span class="token-pair">/ SOL</span>
  </div>
  <span id="live-price" class="up">â€”</span>
  <span id="price-change" class="up">â€”</span>
  <div class="header-right">
    <div class="stat"><span class="stat-label">24h Vol</span><span class="stat-value" id="stat-vol">â€”</span></div>
    <div class="stat"><span class="stat-label">Mcap</span><span class="stat-value" id="stat-mcap">â€”</span></div>
    <div class="stat"><span class="stat-label">Liq</span><span class="stat-value" id="stat-liq">â€”</span></div>
    <div class="stat"><span class="stat-label">Txns 1h</span><span class="stat-value" id="stat-txns">â€”</span></div>
    <div class="status-dot"></div>
    <img class="nich-header-avatar" src="nich.jpg" alt="nich" onerror="this.style.display='none'">
    <div class="links">
      <a href="https://pump.fun/coin/F4ZHCzizwpop2XS8auuAGQ7LZcUTEwQ22m5sRmB2pump" target="_blank">pump.fun</a>
      <a href="https://dexscreener.com/solana/AS5KLCFs4HVYPebV8MNt2YzD2Fs2jgb5F2p3xXjxm9Aj" target="_blank">DexScreener</a>
      <a href="https://x.com/nichxbt" target="_blank">@nichxbt</a>
    </div>
  </div>
</div>

<!-- Chart -->
<div id="chart-area">
  <div id="chart-container"></div>
  <canvas id="markers-canvas"></canvas>

  <!-- Controls -->
  <div id="controls">
    <button class="ctrl-btn active" data-tf="1" data-type="minute">1m</button>
    <button class="ctrl-btn" data-tf="5" data-type="minute">5m</button>
    <button class="ctrl-btn" data-tf="15" data-type="minute">15m</button>
    <button class="ctrl-btn" data-tf="60" data-type="hour">1h</button>
    <span class="ctrl-sep"></span>
    <div id="tweet-toggle" class="ctrl-btn" onclick="toggleTweets()">
      <span class="dot"></span>
      <span>Tweets</span>
      <span id="tweet-count">68</span>
    </div>
    <span class="ctrl-sep"></span>
    <button class="ctrl-btn" onclick="jumpFirst()">First Tweet</button>
    <button class="ctrl-btn" onclick="jumpAll()">All Time</button>
    <button class="ctrl-btn" onclick="jumpLast()">Last Tweet</button>
    <span class="ctrl-sep"></span>
    <button class="ctrl-btn feed-btn" id="feed-toggle-btn" onclick="toggleFeed()">
      <span class="feed-dot"></span>
      <span>Feed</span>
    </button>
  </div>

  <!-- Legend -->
  <div id="legend">
    <div class="legend-item"><div class="legend-circle"></div><span>1 tweet</span></div>
    <div class="legend-item"><div class="legend-circle" style="background:rgba(59,130,246,0.25)"><span style="position:absolute;font-size:6px;font-weight:700;color:#fff;margin-left:2px">3</span></div><span>3+ tweets</span></div>
    <div class="legend-item"><div class="legend-line"></div><span>Quiet period</span></div>
  </div>

  <div id="help-text">Drag to pan Â· Scroll to zoom</div>
</div>

<!-- Tweet Feed Panel -->
<div id="feed-panel">
  <div id="feed-header">
    <img class="nich-avatar" src="nich.jpg" alt="nich" onerror="this.style.display='none'">
    <div>
      <div class="nich-name">nich</div>
      <div class="nich-handle">@nichxbt</div>
    </div>
    <button id="feed-close" onclick="toggleFeed()">&times;</button>
  </div>
  <div id="feed-body">
    <a class="twitter-timeline"
       href="https://twitter.com/nichxbt"
       data-theme="dark"
       data-chrome="noheader nofooter noborders transparent"
       data-tweet-limit="20"
       data-dnt="true">
      Loading @nichxbt tweets...
    </a>
  </div>
</div>

<!-- Tooltip -->
<div id="tweet-tooltip">
  <div class="tt-header">
    <img class="tt-avatar" id="tt-avatar" src="" alt="">
    <div><div class="tt-name">@nichxbt</div><div class="tt-time" id="tt-time"></div></div>
  </div>
  <div class="tt-text" id="tt-text"></div>
  <div class="tt-stats" id="tt-stats"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// pump-sdk Tweet Ã— Price Chart
// Ported from rohunvora/tweet-price-charts (Chart.tsx)
// Canvas overlay markers, clustering, gap lines with glow, adaptive zoom
// Data: GeckoTerminal OHLCV + DexScreener live + embedded tweets
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MINT = 'F4ZHCzizwpop2XS8auuAGQ7LZcUTEwQ22m5sRmB2pump';
const POOL = 'AS5KLCFs4HVYPebV8MNt2YzD2Fs2jgb5F2p3xXjxm9Aj';
const GECKO = 'https://api.geckoterminal.com/api/v2/networks/solana/pools/' + POOL;
const DEXSCREENER = 'https://api.dexscreener.com/latest/dex/tokens/' + MINT;

const MARKER_COLOR = '#3B82F6';
const SILENCE_GAP_THRESHOLD = 24 * 60 * 60;

// â”€â”€ Embedded tweet data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TWEETS = [
  {"ts":"2026-02-26T20:58:26.000Z","text":"are token locks still a thing like ive been building â€” lets run this properly for the trenches. we need it","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027126131250643230"},
  {"ts":"2026-02-26T21:00:04.000Z","text":"claim","likes":"21","views":"2.1K","url":"https://x.com/nichxbt/status/2027126541520617662"},
  {"ts":"2026-02-26T21:02:02.000Z","text":"i pushed $GCR for a year to 13m so like can we run this back turbo","likes":"19","views":"805","url":"https://x.com/nichxbt/status/2027127035232166242"},
  {"ts":"2026-02-26T21:03:28.000Z","text":"i am on the front page of pumpfun","likes":"51","views":"2.5K","url":"https://x.com/nichxbt/status/2027127396181365176"},
  {"ts":"2026-02-26T21:04:03.000Z","text":"screenshot it when im number 1 please","likes":"6","views":"415","url":"https://x.com/nichxbt/status/2027127543296627102"},
  {"ts":"2026-02-26T21:05:29.000Z","text":"on it","likes":"7","views":"174","url":"https://x.com/nichxbt/status/2027127905772568618"},
  {"ts":"2026-02-26T21:06:27.000Z","text":"@Ga__ke nihao fine shyt","likes":"6","views":"346","url":"https://x.com/nichxbt/status/2027128149415497919"},
  {"ts":"2026-02-26T21:07:26.000Z","text":"im trying they dont make it very user friendly yet they can improve","likes":"3","views":"108","url":"https://x.com/nichxbt/status/2027128396522938452"},
  {"ts":"2026-02-26T21:07:38.000Z","text":"wait","likes":"12","views":"457","url":"https://x.com/nichxbt/status/2027128448104407193"},
  {"ts":"2026-02-26T21:08:01.000Z","text":"@a1lon9 @Pumpfun i have a cook","likes":"22","views":"2.3K","url":"https://x.com/nichxbt/status/2027128544644743496"},
  {"ts":"2026-02-26T21:09:03.000Z","text":"no legit if someone sends me a link i will","likes":"2","views":"189","url":"https://x.com/nichxbt/status/2027128802929996186"},
  {"ts":"2026-02-26T21:10:08.000Z","text":"easy bet","likes":"3","views":"108","url":"https://x.com/nichxbt/status/2027129075953991774"},
  {"ts":"2026-02-26T21:10:21.000Z","text":"is 100% buy back standard","likes":"5","views":"130","url":"https://x.com/nichxbt/status/2027129131935375390"},
  {"ts":"2026-02-26T21:10:50.000Z","text":"i want a dev buy back candle larger than gake candle â€” nich candle now","likes":"9","views":"343","url":"https://x.com/nichxbt/status/2027129253524017449"},
  {"ts":"2026-02-26T21:12:07.000Z","text":"someone record this candle","likes":"27","views":"1.7K","url":"https://x.com/nichxbt/status/2027129573100634365"},
  {"ts":"2026-02-26T21:15:38.000Z","text":"(media)","likes":"58","views":"5.1K","url":"https://x.com/nichxbt/status/2027130459285782618"},
  {"ts":"2026-02-26T21:22:39.000Z","text":"aight i downloaded the app","likes":"18","views":"1.6K","url":"https://x.com/nichxbt/status/2027132224794157544"},
  {"ts":"2026-02-26T21:25:43.000Z","text":"i claimed","likes":"12","views":"263","url":"https://x.com/nichxbt/status/2027132997879914956"},
  {"ts":"2026-02-26T21:28:34.000Z","text":"this is crazy but like how high is $PUMP again","likes":"18","views":"1.3K","url":"https://x.com/nichxbt/status/2027133712476025015"},
  {"ts":"2026-02-26T21:31:51.000Z","text":"pump-sdk is actually so crazy if you think about it","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027134539731227080"},
  {"ts":"2026-02-26T21:35:26.000Z","text":"would you?","likes":"","views":"120","url":"https://x.com/nichxbt/status/2027135442936889776"},
  {"ts":"2026-02-26T21:36:18.000Z","text":"you little shits better listen here â€” aint no one telling me what to do","likes":"52","views":"2.2K","url":"https://x.com/nichxbt/status/2027135662533869901"},
  {"ts":"2026-02-26T21:37:24.000Z","text":"thanks","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027135937726312584"},
  {"ts":"2026-02-26T21:38:24.000Z","text":"thank you. let's build a community","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027136187828421058"},
  {"ts":"2026-02-26T21:38:43.000Z","text":"study small active accounts pushing a token","likes":"331","views":"16K","url":"https://x.com/nichxbt/status/2027136267750908006"},
  {"ts":"2026-02-26T21:40:16.000Z","text":"sure","likes":"6","views":"116","url":"https://x.com/nichxbt/status/2027136658672664746"},
  {"ts":"2026-02-26T21:42:08.000Z","text":"hey","likes":"3","views":"223","url":"https://x.com/nichxbt/status/2027137129789509838"},
  {"ts":"2026-02-26T21:48:19.000Z","text":"wait you have me thinking â€” i have a telegram claim bot i was working on this morning. we will release it","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027138682613047343"},
  {"ts":"2026-02-26T21:49:12.000Z","text":"i aint finna go back to jail","likes":"5","views":"85","url":"https://x.com/nichxbt/status/2027138909042597960"},
  {"ts":"2026-02-26T21:50:17.000Z","text":"allow me to cook check this out one sec","likes":"9","views":"181","url":"https://x.com/nichxbt/status/2027139178253914576"},
  {"ts":"2026-02-26T21:55:26.000Z","text":"Give AI agents access to money. MCP servers for your AI agents to interact with DeFi","likes":"80","views":"7.8K","url":"https://x.com/nichxbt/status/2027140474147082543"},
  {"ts":"2026-02-26T21:56:05.000Z","text":"WE WILL INTEGRATE PUMP-SDK","likes":"33","views":"1.6K","url":"https://x.com/nichxbt/status/2027140637305512347"},
  {"ts":"2026-02-26T21:57:14.000Z","text":"it took me what felt like an hour to figure out how to claim for pump-sdk","likes":"27","views":"1.9K","url":"https://x.com/nichxbt/status/2027140927450755376"},
  {"ts":"2026-02-26T22:00:09.000Z","text":"if you sign up for SperaxOS where pump-fun-sdk will be integrated then i will","likes":"12","views":"246","url":"https://x.com/nichxbt/status/2027141664456982857"},
  {"ts":"2026-02-26T22:03:25.000Z","text":"how about we do things differently than all these other projects â€” let's collaborate and build","likes":"5","views":"488","url":"https://x.com/nichxbt/status/2027142486595109018"},
  {"ts":"2026-02-26T22:04:22.000Z","text":"omg... this is why we do this â€” i have yet to see anyone do this â€” you are genius","likes":"20","views":"1.4K","url":"https://x.com/nichxbt/status/2027142723246121171"},
  {"ts":"2026-02-26T22:05:46.000Z","text":"with the pump-fun-sdk you can definitely claim and forward fees to your agent","likes":"23","views":"1.7K","url":"https://x.com/nichxbt/status/2027143075194355834"},
  {"ts":"2026-02-26T22:07:18.000Z","text":"me you and shaw â€” let's lead by example. it's time","likes":"2","views":"74","url":"https://x.com/nichxbt/status/2027143463121334719"},
  {"ts":"2026-02-26T22:09:37.000Z","text":"exactly â€” my agents already on it. TTS is so nice. chat.sperax.io/beta â€” you can legit just speak to your agents","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027144043210396152"},
  {"ts":"2026-02-26T22:11:26.000Z","text":"buying a domain, paying for hosting, running the project â€” its the pump-fun-sdk","likes":"4","views":"104","url":"https://x.com/nichxbt/status/2027144502721548523"},
  {"ts":"2026-02-26T22:16:05.000Z","text":"i am looking for projects to collaborate with â€” it's quite simple to integrate existing projects within SperaxOS","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027145670596202721"},
  {"ts":"2026-02-26T22:18:16.000Z","text":"seriously even if you launched for fun and have no motion. post below, share your idea. let's build","likes":"14","views":"773","url":"https://x.com/nichxbt/status/2027146220544970886"},
  {"ts":"2026-02-26T22:20:12.000Z","text":"you still owe me $100 so please use my credit for a new video on the pump-fun-sdk","likes":"1","views":"58","url":"https://x.com/nichxbt/status/2027146708568945134"},
  {"ts":"2026-02-26T22:21:02.000Z","text":"no pump-fun-sdk is the one â€” we don't do pvp here","likes":"","views":"92","url":"https://x.com/nichxbt/status/2027146918758064148"},
  {"ts":"2026-02-26T22:23:57.000Z","text":"let's show them how to build in public with the pump-fun-sdk","likes":"2","views":"148","url":"https://x.com/nichxbt/status/2027147652312547477"},
  {"ts":"2026-02-26T22:26:16.000Z","text":"pump-sdk the official @Pumpfun source code reverse engineered â€” and they launched a coin on pumpfun. we have agents","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027148236658749578"},
  {"ts":"2026-02-26T22:33:06.000Z","text":"Want to run AI agents 24/7? Copilot, Claude, or Cursor within Github Codespaces...","likes":"17","views":"1.6K","url":"https://x.com/nichxbt/status/2027149953131491722"},
  {"ts":"2026-02-26T22:34:34.000Z","text":"With the pump-sdk you can build crypto tools, monitor memecoin launches, claims, or snipe tokens","likes":"18","views":"1.6K","url":"https://x.com/nichxbt/status/2027150323291504698"},
  {"ts":"2026-02-26T22:48:10.000Z","text":"added solana wallet vanity address generator â€” generate a nice vanity address for your agents","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027153748393603086"},
  {"ts":"2026-02-26T22:50:49.000Z","text":"what's your github @ ? ill add you as contributor if you want to collab","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027154411370484209"},
  {"ts":"2026-02-26T23:01:17.000Z","text":"pump-fun-sdk: The Reverse-Engineered Pumpfun Bonding Curve SDK Powering the Next Generation of Solana AI Agents","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027157045749993539"},
  {"ts":"2026-02-26T23:17:58.000Z","text":"bullish","likes":"10","views":"428","url":"https://x.com/nichxbt/status/2027161244344684743"},
  {"ts":"2026-02-26T23:39:57.000Z","text":"not enough will scoop dips","likes":"9","views":"1.7K","url":"https://x.com/nichxbt/status/2027166778695221600"},
  {"ts":"2026-02-26T23:47:20.000Z","text":"the agents are cooking check the repo its nuts","likes":"3","views":"338","url":"https://x.com/nichxbt/status/2027168637900251483"},
  {"ts":"2026-02-27T00:08:01.000Z","text":"pump-fun-sdk is now listed on @AnthropicAI's official MCP Registry","likes":"75","views":"8.8K","url":"https://x.com/nichxbt/status/2027173839826976778"},
  {"ts":"2026-02-27T00:10:08.000Z","text":"TypeScript/Rust SDK for the Pump protocol on Solana â€” offline instruction builders, bonding curve math","likes":"14","views":"617","url":"https://x.com/nichxbt/status/2027174372482711656"},
  {"ts":"2026-02-27T00:22:25.000Z","text":"Pump SDK Core â€” Instruction Building & On-Chain Interaction for Pump Protocol on @openclaw ClawHub","likes":"31","views":"2.3K","url":"https://x.com/nichxbt/status/2027177463567224969"},
  {"ts":"2026-02-27T00:22:47.000Z","text":"The skill's declared requirements and runtime instructions are coherent with its stated purpose","likes":"10","views":"619","url":"https://x.com/nichxbt/status/2027177559071641770"},
  {"ts":"2026-02-27T00:30:25.000Z","text":"crypto tools are so fun to build â€” give your agents access to money and watch what they can do!","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027179477420409237"},
  {"ts":"2026-02-27T01:29:18.000Z","text":"correct","likes":"5","views":"117","url":"https://x.com/nichxbt/status/2027194294952710321"},
  {"ts":"2026-02-27T01:30:30.000Z","text":"soon â€” have something really exciting planned for this. stay tuned!","likes":"9","views":"261","url":"https://x.com/nichxbt/status/2027194598070886625"},
  {"ts":"2026-02-27T03:27:22.000Z","text":"Real-time PumpFun token tracking â€” built with raw WebSockets on Solana using pump-fun-sdk","likes":"24","views":"1.1K","url":"https://x.com/nichxbt/status/2027224007486194094"},
  {"ts":"2026-02-27T03:40:47.000Z","text":"spent the last couple of months working on it â€” live today. you will want to rack up the refs","likes":"1","views":"95","url":"https://x.com/nichxbt/status/2027227387881312446"},
  {"ts":"2026-02-27T03:55:07.000Z","text":"omg remotion + pump-sdk â€” watch this","likes":"11","views":"202","url":"https://x.com/nichxbt/status/2027230992872911088"},
  {"ts":"2026-02-27T04:01:58.000Z","text":"(media)","likes":"2","views":"51","url":"https://x.com/nichxbt/status/2027232717772128427"},
  {"ts":"2026-02-27T04:04:49.000Z","text":"i think people will be scared to see how long i can go","likes":"4","views":"25","url":"https://x.com/nichxbt/status/2027233432854782143"},
  {"ts":"2026-02-27T04:47:28.000Z","text":"Generate custom Solana vanity addresses - entirely in your browser. pump-fun-sdk","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027244165738930609"},
  {"ts":"2026-02-27T04:52:36.000Z","text":"not sure why the agents prefer the terminal look maybe because haha terminal... pumpfun... haha","likes":"","views":"0","url":"https://x.com/nichxbt/status/2027245458717057406"}
];

// Convert to tweet-price-charts TweetEvent-like objects with unix timestamps
const tweetEvents = TWEETS.map(t => ({
  timestamp: Math.floor(new Date(t.ts).getTime() / 1000),
  text: t.text,
  likes: parseInt(t.likes) || 0,
  views: t.views,
  url: t.url,
  price_at_tweet: null, // Will be filled from candle data
})).sort((a, b) => a.timestamp - b.timestamp);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// State
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chart, candleSeries, volumeSeries;
let candles = [];          // Current candle data [{time, open, high, low, close, volume}]
let candleTimes = [];      // Sorted timestamps for binary search
let clusters = [];         // Current visible clusters for click detection
let showBubbles = true;
let hoveredTweet = null;
let currentTf = { type: 'minute', agg: 1 };
let avatarImg = null;
let animFrame = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Helpers (from tweet-price-charts/formatters.ts)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const fmtUsd = n => n >= 1e6 ? '$'+(n/1e6).toFixed(2)+'M' : n >= 1e3 ? '$'+(n/1e3).toFixed(1)+'K' : '$'+n.toFixed(4);
const fmtPrice = n => n >= 1 ? '$'+n.toFixed(2) : n >= 0.01 ? '$'+n.toFixed(4) : n >= 0.0001 ? '$'+n.toFixed(6) : '$'+n.toFixed(8);
const parseViews = s => { if (!s) return 0; s = String(s).replace(',',''); if (s.endsWith('K')) return parseFloat(s)*1000; if (s.endsWith('M')) return parseFloat(s)*1e6; return parseInt(s)||0; };

function formatTimeGap(seconds) {
  const hours = seconds / 3600;
  if (hours < 1) return Math.round(seconds / 60) + 'm';
  if (hours < 24) return Math.round(hours) + 'h';
  return Math.round(hours / 24) + 'd';
}

function formatPctChange(pct) {
  const sign = pct >= 0 ? '+' : '';
  if (Math.abs(pct) >= 10) return sign + pct.toFixed(0) + '%';
  return sign + pct.toFixed(1) + '%';
}

function withAlpha(hex, alpha) {
  if (hex.startsWith('#')) {
    let h = hex.slice(1);
    if (h.length === 3) h = h.split('').map(c => c + c).join('');
    const r = parseInt(h.slice(0,2),16), g = parseInt(h.slice(2,4),16), b = parseInt(h.slice(4,6),16);
    return `rgba(${r},${g},${b},${alpha})`;
  }
  const m = hex.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
  return m ? `rgba(${m[1]},${m[2]},${m[3]},${alpha})` : hex;
}

// Binary search: find nearest candle time to a timestamp (from Chart.tsx)
function findNearestCandleTime(timestamp) {
  if (candleTimes.length === 0) return null;
  let left = 0, right = candleTimes.length - 1;
  while (left < right) {
    const mid = Math.floor((left + right) / 2);
    if (candleTimes[mid] < timestamp) left = mid + 1;
    else right = mid;
  }
  if (left > 0) {
    const dl = Math.abs(candleTimes[left] - timestamp);
    const dp = Math.abs(candleTimes[left - 1] - timestamp);
    if (dp < dl) return candleTimes[left - 1];
  }
  return candleTimes[left];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chart setup (from Chart.tsx createChart config)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initChart() {
  const container = document.getElementById('chart-container');
  const h = window.innerHeight - 48; // subtract header
  const area = document.getElementById('chart-area');
  area.style.height = h + 'px';
  container.style.height = h + 'px';

  chart = LightweightCharts.createChart(container, {
    width: container.clientWidth,
    height: h,
    layout: {
      background: { type: 'solid', color: '#0D0C0B' },
      textColor: '#FAFAFA',
      fontFamily: "-apple-system, BlinkMacSystemFont, 'Inter', sans-serif",
      fontSize: 11,
    },
    grid: {
      vertLines: { color: '#161619' },
      horzLines: { color: '#161619' },
    },
    crosshair: {
      mode: LightweightCharts.CrosshairMode.Normal,
      vertLine: { color: '#52525B', width: 1, style: 0, labelBackgroundColor: 'rgba(255,255,255,0.08)' },
      horzLine: { color: '#52525B', width: 1, style: 0, labelBackgroundColor: 'rgba(255,255,255,0.08)' },
    },
    timeScale: {
      borderColor: 'rgba(255,255,255,0.08)',
      timeVisible: true,
      secondsVisible: false,
      rightOffset: 5,
      minBarSpacing: 0.5,
    },
    rightPriceScale: {
      borderColor: 'rgba(255,255,255,0.08)',
      textColor: '#A1A1AA',
      autoScale: true,
      scaleMargins: { top: 0.1, bottom: 0.2 },
    },
    handleScroll: { mouseWheel: true, pressedMouseMove: true, horzTouchDrag: true, vertTouchDrag: true },
    handleScale: {
      axisPressedMouseMove: { time: true, price: true },
      axisDoubleClickReset: { time: true, price: true },
      mouseWheel: true, pinch: true,
    },
    localization: {
      priceFormatter: p => p >= 1 ? p.toFixed(2) : p >= 0.01 ? p.toFixed(4) : p.toFixed(6),
    },
  });

  // Candlestick series â€” muted teal/coral palette (the stage, not the star)
  candleSeries = chart.addCandlestickSeries({
    upColor: 'rgba(94,186,162,0.35)',
    downColor: 'rgba(216,126,136,0.35)',
    borderUpColor: 'rgba(94,186,162,0.48)',
    borderDownColor: 'rgba(216,126,136,0.48)',
    wickUpColor: 'rgba(94,186,162,0.35)',
    wickDownColor: 'rgba(216,126,136,0.35)',
  });

  // Volume histogram
  volumeSeries = chart.addHistogramSeries({
    priceFormat: { type: 'volume' },
    priceScaleId: '',
    scaleMargins: { top: 0.85, bottom: 0 },
  });

  // Redraw markers on pan/zoom
  chart.timeScale().subscribeVisibleTimeRangeChange(() => drawMarkers());

  // Hover detection (from Chart.tsx subscribeCrosshairMove)
  chart.subscribeCrosshairMove(param => {
    if (!param.point) { hideTooltip(); return; }
    const { x, y } = param.point;
    const HOVER_R = 24;

    // Check cluster hover for cursor
    const overMulti = clusters.some(c => c.tweets.length > 1 && Math.hypot(c.x - x, c.y - y) < HOVER_R);
    container.style.cursor = overMulti ? 'pointer' : '';

    for (const tw of tweetEvents) {
      if (tw.price_at_tweet === null) continue;
      const nt = findNearestCandleTime(tw.timestamp);
      const tx = nt !== null ? chart.timeScale().timeToCoordinate(nt) : null;
      const ty = candleSeries.priceToCoordinate(tw.price_at_tweet);
      if (tx !== null && ty !== null && Math.hypot(tx - x, ty - y) < HOVER_R) {
        showTooltip(tw, tx, ty);
        return;
      }
    }
    hideTooltip();
  });

  // Click handler (from Chart.tsx subscribeClick)
  chart.subscribeClick(param => {
    if (!param.point) return;
    const { x, y } = param.point;
    for (const cluster of clusters) {
      if (Math.hypot(cluster.x - x, cluster.y - y) < 24) {
        if (cluster.tweets.length === 1) {
          window.open(cluster.tweets[0].url, '_blank');
        } else {
          // Zoom into cluster
          const times = cluster.tweets.map(t => t.timestamp);
          const tMin = Math.min(...times), tMax = Math.max(...times);
          const pad = Math.max((tMax - tMin) * 0.5, 7200);
          animateToRange(tMin - pad, tMax + pad);
        }
        return;
      }
    }
  });

  // Resize
  window.addEventListener('resize', () => {
    const newH = window.innerHeight - 48;
    const newW = feedOpen ? window.innerWidth - 380 : window.innerWidth;
    area.style.height = newH + 'px';
    area.style.width = newW + 'px';
    container.style.height = newH + 'px';
    container.style.width = newW + 'px';
    chart.resize(newW, newH);
    requestAnimationFrame(() => requestAnimationFrame(drawMarkers));
  });

  // Load avatar
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.src = 'nich.jpg';
  img.onload = () => { avatarImg = img; drawMarkers(); };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAW MARKERS â€” Canvas overlay (ported from Chart.tsx drawMarkers)
// Clustering, gap lines with glow, adaptive sizing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawMarkers() {
  const canvas = document.getElementById('markers-canvas');
  const area = document.getElementById('chart-area');
  if (!canvas || !chart || !candleSeries) return;

  const dpr = window.devicePixelRatio || 1;
  const w = area.clientWidth, h = area.clientHeight;
  canvas.width = w * dpr;
  canvas.height = h * dpr;
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';

  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  ctx.clearRect(0, 0, w, h);

  if (!showBubbles) { clusters = []; return; }

  const visibleRange = chart.timeScale().getVisibleRange();
  if (!visibleRange) { clusters = []; return; }

  const rangeFrom = visibleRange.from, rangeTo = visibleRange.to;
  const visibleSeconds = rangeTo - rangeFrom;

  // Adaptive sizing (from Chart.tsx)
  const zoomFactor = Math.min(1, Math.max(0.4, 86400 * 7 / visibleSeconds));
  const bubbleSize = Math.round(24 + 16 * zoomFactor);
  const bubbleRadius = bubbleSize / 2;
  const clusterThreshold = bubbleSize + 8;
  const timeFontSize = Math.round(8 + 4 * zoomFactor);
  const pctFontSize = Math.round(9 + 4 * zoomFactor);
  const labelSpacing = Math.round(9 + 4 * zoomFactor);

  // Filter visible tweets, snap prices from candles
  const visible = tweetEvents.filter(t => {
    if (t.timestamp < rangeFrom || t.timestamp > rangeTo) return false;
    // Snap price from nearest candle if not set
    if (t.price_at_tweet === null) {
      const nt = findNearestCandleTime(t.timestamp);
      if (nt !== null) {
        const c = candles.find(cd => cd.time === nt);
        if (c) t.price_at_tweet = c.close;
      }
    }
    return t.price_at_tweet !== null;
  }).sort((a, b) => a.timestamp - b.timestamp);

  if (visible.length === 0) { clusters = []; return; }

  // â”€â”€ Build clusters (from Chart.tsx "drifting center" algorithm) â”€â”€
  clusters = [];
  let curTweets = [], clusterX = null, sumTs = 0, sumChange = 0, changeCount = 0;

  function emitCluster(tweets, cx, sts) {
    const exitPrice = tweets[tweets.length - 1].price_at_tweet;
    const entryPrice = tweets[0].price_at_tweet;
    const y = candleSeries.priceToCoordinate(exitPrice);
    const entryY = candleSeries.priceToCoordinate(entryPrice);
    if (y === null || entryY === null) return;
    clusters.push({
      tweets, x: cx, y, entryY,
      exitPrice, entryPrice,
      avgTimestamp: sts / tweets.length,
      firstTweet: tweets[0], lastTweet: tweets[tweets.length - 1],
      timeSincePrev: null, pctSincePrev: null,
    });
  }

  for (const tw of visible) {
    const nt = findNearestCandleTime(tw.timestamp);
    const x = nt !== null ? chart.timeScale().timeToCoordinate(nt) : null;
    if (x === null) continue;

    if (clusterX !== null && Math.abs(x - clusterX) < clusterThreshold) {
      curTweets.push(tw);
      clusterX = (clusterX * (curTweets.length - 1) + x) / curTweets.length;
      sumTs += tw.timestamp;
    } else {
      if (curTweets.length > 0 && clusterX !== null) emitCluster(curTweets, clusterX, sumTs);
      curTweets = [tw]; clusterX = x; sumTs = tw.timestamp;
    }
  }
  if (curTweets.length > 0 && clusterX !== null) emitCluster(curTweets, clusterX, sumTs);

  // â”€â”€ Gap statistics (exit-to-exit model from Chart.tsx) â”€â”€
  for (let i = 1; i < clusters.length; i++) {
    const prev = clusters[i - 1], curr = clusters[i];
    curr.timeSincePrev = curr.firstTweet.timestamp - prev.lastTweet.timestamp;
    if (prev.exitPrice > 0 && curr.exitPrice > 0) {
      curr.pctSincePrev = ((curr.exitPrice - prev.exitPrice) / prev.exitPrice) * 100;
    }
  }

  // â”€â”€ Draw gap lines with glow (from Chart.tsx drawSilenceLineWithGlow) â”€â”€
  const adaptiveLabelThreshold = Math.max(1800, Math.min(visibleSeconds * 0.05, SILENCE_GAP_THRESHOLD));

  for (let i = 1; i < clusters.length; i++) {
    const prev = clusters[i - 1], curr = clusters[i];
    const gap = curr.timeSincePrev || 0;
    const pct = curr.pctSincePrev;
    const isNeg = pct !== null && pct < 0;
    const lineColor = isNeg ? '#EF5350' : '#22C55E';

    const startX = prev.x + bubbleRadius + 4;
    const endX = curr.x - bubbleRadius - 4;
    const midX = (startX + endX) / 2;
    const midY = (prev.y + curr.y) / 2;
    const lineLen = Math.hypot(endX - startX, curr.y - prev.y);

    const hasSpace = endX > startX + 8;
    const hasMeaningfulGap = gap > 1800;
    const hasMeaningfulChange = pct !== null && Math.abs(pct) > 1;
    const hasMinorGap = gap > 900;

    if (hasSpace) {
      if (hasMeaningfulGap && hasMeaningfulChange) {
        // Full glow line (4-pass from Chart.tsx)
        drawGlowLine(ctx, startX, prev.y, endX, curr.y, lineColor, pct || 10);

        // Labels for significant gaps
        if (gap > adaptiveLabelThreshold && lineLen > 60) {
          const dir = isNeg ? -1 : 1;
          const base = dir * (labelSpacing + 8);
          ctx.font = `${timeFontSize}px system-ui, sans-serif`;
          ctx.textAlign = 'center';
          ctx.fillStyle = '#A1A1AA';
          ctx.fillText(formatTimeGap(gap), midX, midY + base);
          ctx.font = `bold ${pctFontSize}px system-ui, sans-serif`;
          ctx.fillStyle = isNeg ? '#EF4444' : '#22C55E';
          ctx.fillText(formatPctChange(pct), midX, midY + base + dir * labelSpacing);
        }
      } else if (hasMeaningfulGap) {
        // Thin colored line
        ctx.save(); ctx.setLineDash([4, 6]);
        ctx.strokeStyle = lineColor + '50'; ctx.lineWidth = 1.5;
        ctx.beginPath(); ctx.moveTo(startX, prev.y); ctx.lineTo(endX, curr.y); ctx.stroke();
        ctx.restore();
      } else if (hasMinorGap) {
        // Subtle connector
        ctx.save(); ctx.setLineDash([3, 5]);
        ctx.strokeStyle = '#71717A40'; ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(startX, prev.y); ctx.lineTo(endX, curr.y); ctx.stroke();
        ctx.restore();
      }
    }
  }
  ctx.setLineDash([]);

  // â”€â”€ Ongoing silence (from Chart.tsx) â”€â”€
  if (candles.length > 0 && tweetEvents.length > 0) {
    const tweetsWithPrice = tweetEvents.filter(t => t.price_at_tweet !== null);
    if (tweetsWithPrice.length > 0) {
      const lastTw = tweetsWithPrice[tweetsWithPrice.length - 1];
      const lastCandle = candles[candles.length - 1];
      const silence = lastCandle.time - lastTw.timestamp;
      if (silence > SILENCE_GAP_THRESHOLD) {
        const lwNt = findNearestCandleTime(lastTw.timestamp);
        const lwX = lwNt !== null ? chart.timeScale().timeToCoordinate(lwNt) : null;
        const lwY = candleSeries.priceToCoordinate(lastTw.price_at_tweet);
        const lcX = chart.timeScale().timeToCoordinate(lastCandle.time);
        const lcY = candleSeries.priceToCoordinate(lastCandle.close);
        if (lwX !== null && lwY !== null && lcX !== null && lcY !== null && lcX > lwX + bubbleRadius) {
          const pct = ((lastCandle.close - lastTw.price_at_tweet) / lastTw.price_at_tweet) * 100;
          const isNeg = pct < 0;
          drawGlowLine(ctx, lwX + bubbleRadius + 4, lwY, lcX, lcY, isNeg ? '#EF5350' : '#22C55E', pct);
          // "now" dot
          ctx.beginPath(); ctx.arc(lcX, lcY, 4, 0, Math.PI * 2);
          ctx.fillStyle = isNeg ? '#EF4444' : '#22C55E'; ctx.fill();
          ctx.strokeStyle = '#FFF'; ctx.lineWidth = 1.5; ctx.stroke();
        }
      }
    }
  }

  // â”€â”€ Draw markers (from Chart.tsx cluster rendering) â”€â”€
  for (let i = 0; i < clusters.length; i++) {
    const cl = clusters[i];
    const { x, y, tweets } = cl;
    const count = tweets.length;
    const isMulti = count > 1;
    const isHov = hoveredTweet && tweets.some(t => t.timestamp === hoveredTweet.timestamp);

    // Hover glow
    if (isHov) {
      ctx.beginPath(); ctx.arc(x, y, bubbleRadius + 5, 0, Math.PI * 2);
      ctx.fillStyle = withAlpha(MARKER_COLOR, 0.2); ctx.fill();
    }
    // Multi glow
    if (isMulti) {
      ctx.beginPath(); ctx.arc(x, y, bubbleRadius + 4, 0, Math.PI * 2);
      ctx.fillStyle = withAlpha(MARKER_COLOR, 0.15); ctx.fill();
    }
    // Border ring
    ctx.beginPath(); ctx.arc(x, y, bubbleRadius + 2, 0, Math.PI * 2);
    ctx.strokeStyle = isHov ? MARKER_COLOR : 'rgba(255,255,255,0.5)';
    ctx.lineWidth = isHov ? 2.5 : 1.5; ctx.stroke();

    // Avatar or fallback
    if (avatarImg) {
      ctx.save();
      ctx.beginPath(); ctx.arc(x, y, bubbleRadius, 0, Math.PI * 2); ctx.clip();
      ctx.drawImage(avatarImg, x - bubbleRadius, y - bubbleRadius, bubbleSize, bubbleSize);
      ctx.restore();
    } else {
      ctx.beginPath(); ctx.arc(x, y, bubbleRadius, 0, Math.PI * 2);
      ctx.fillStyle = MARKER_COLOR; ctx.fill();
    }

    // Count badge
    if (isMulti) {
      const bs = Math.max(12, bubbleSize * 0.35);
      const bx = x + bubbleRadius - bs / 2, by = y - bubbleRadius + bs / 3;
      ctx.beginPath(); ctx.arc(bx, by, bs / 2 + 2, 0, Math.PI * 2);
      ctx.fillStyle = withAlpha(MARKER_COLOR, 0.9); ctx.fill();
      ctx.strokeStyle = 'rgba(255,255,255,0.7)'; ctx.lineWidth = 1; ctx.stroke();
      ctx.fillStyle = '#FFF';
      ctx.font = `bold ${Math.round(bs * 0.7)}px system-ui, sans-serif`;
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText(count.toString(), bx, by);
    }
  }
}

// 4-pass premium glow (from Chart.tsx drawSilenceLineWithGlow)
function drawGlowLine(ctx, x1, y1, x2, y2, color, magnitude) {
  const hex = color.startsWith('rgba') ? (color.includes('239') ? '#EF5350' : '#22C55E') : color;
  const cm = Math.max(5, Math.min(Math.abs(magnitude), 50));
  const intensity = 0.3 + ((cm - 5) / 45) * 0.7;

  ctx.save();
  ctx.setLineDash([6, 8]);
  ctx.lineCap = 'round'; ctx.lineWidth = 2;
  ctx.shadowOffsetX = 0; ctx.shadowOffsetY = 0;

  const passes = [
    { blur: 24 * intensity, alpha: 0.03 * intensity },
    { blur: 12 * intensity, alpha: 0.08 * intensity },
    { blur: 6, alpha: 0.15 * intensity },
    { blur: 2, alpha: 0.25 * intensity },
  ];
  ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
  passes.forEach(({ blur, alpha }) => {
    const ah = Math.round(alpha * 255).toString(16).padStart(2, '0');
    ctx.shadowColor = hex + ah; ctx.shadowBlur = blur;
    ctx.strokeStyle = 'transparent'; ctx.stroke();
  });
  ctx.shadowColor = hex + '40'; ctx.shadowBlur = 4;
  ctx.strokeStyle = hex + 'CC'; ctx.stroke();
  ctx.restore();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tooltip
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTooltip(tw, x, y) {
  hoveredTweet = tw;
  const tt = document.getElementById('tweet-tooltip');
  const d = new Date(tw.timestamp * 1000);
  document.getElementById('tt-time').textContent = d.toLocaleDateString('en-US', { month:'short', day:'numeric', hour:'numeric', minute:'2-digit' });
  document.getElementById('tt-text').textContent = tw.text;
  document.getElementById('tt-stats').innerHTML = `<span>â¤ï¸ ${tw.likes.toLocaleString()}</span><span>ğŸ‘ ${tw.views}</span>`;
  if (avatarImg) document.getElementById('tt-avatar').src = avatarImg.src;

  const rect = document.getElementById('chart-area').getBoundingClientRect();
  tt.style.left = Math.min(rect.left + x + 20, window.innerWidth - 340) + 'px';
  tt.style.top = Math.max(rect.top + y - 60, 10) + 'px';
  tt.classList.add('visible');
  drawMarkers(); // redraw for hover highlight
}

function hideTooltip() {
  if (!hoveredTweet) return;
  hoveredTweet = null;
  document.getElementById('tweet-tooltip').classList.remove('visible');
  drawMarkers();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Animation (from Chart.tsx animateToRange â€” ease-out cubic)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function animateToRange(targetFrom, targetTo) {
  const chartRange = chart.timeScale().getVisibleRange();
  if (!chartRange) {
    chart.timeScale().setVisibleRange({ from: targetFrom, to: targetTo });
    return;
  }
  const start = { from: chartRange.from, to: chartRange.to };
  const dur = 300, t0 = performance.now();
  (function tick() {
    const t = Math.min((performance.now() - t0) / dur, 1);
    const e = 1 - (1 - t) ** 3;
    chart.timeScale().setVisibleRange({
      from: start.from + (targetFrom - start.from) * e,
      to: start.to + (targetTo - start.to) * e,
    });
    if (t < 1) requestAnimationFrame(tick);
  })();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Navigation (from Chart.tsx jumpToFirstTweet, jumpToAllTime, jumpToLastTweet)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function jumpFirst() {
  if (!tweetEvents.length) return;
  const first = tweetEvents[0];
  const oneDay = 86400;
  animateToRange(first.timestamp - oneDay, first.timestamp + 7 * oneDay);
}

function jumpLast() {
  if (!tweetEvents.length) return;
  const last = tweetEvents[tweetEvents.length - 1];
  const now = Math.floor(Date.now() / 1000);
  animateToRange(last.timestamp - 7 * 86400, now);
}

function jumpAll() {
  if (!chart || candles.length === 0) return;
  chart.timeScale().fitContent();
}

function toggleTweets() {
  showBubbles = !showBubbles;
  document.getElementById('tweet-toggle').classList.toggle('off', !showBubbles);
  drawMarkers();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Data fetching
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchOHLCV(type, agg) {
  const url = `${GECKO}/ohlcv/${type}?aggregate=${agg}&limit=1000&currency=usd`;
  try {
    const r = await fetch(url);
    const d = await r.json();
    const list = d.data?.attributes?.ohlcv_list || [];
    return list.map(([ts, o, h, l, c, v]) => ({
      time: ts, open: o, high: h, low: l, close: c, volume: v,
    })).sort((a, b) => a.time - b.time);
  } catch (e) { console.error('OHLCV error:', e); return []; }
}

async function loadTimeframe(type, agg) {
  currentTf = { type, agg };
  const data = await fetchOHLCV(type, agg);
  if (!data.length) return;

  candles = data;
  candleTimes = data.map(c => c.time);

  // Reset tweet price associations so they re-snap
  tweetEvents.forEach(t => t.price_at_tweet = null);

  candleSeries.setData(data.map(c => ({ time: c.time, open: c.open, high: c.high, low: c.low, close: c.close })));
  volumeSeries.setData(data.map(c => ({
    time: c.time, value: c.volume,
    color: c.close >= c.open ? 'rgba(94,186,162,0.12)' : 'rgba(216,126,136,0.1)',
  })));

  chart.timeScale().fitContent();
  setTimeout(drawMarkers, 100);

  // Update price from last candle
  const last = data[data.length - 1];
  if (last) updatePrice(last.close);
}

function updatePrice(price) {
  document.getElementById('live-price').textContent = fmtPrice(price);
}

async function fetchDexStats() {
  try {
    const r = await fetch(DEXSCREENER);
    const d = await r.json();
    const p = d.pairs?.[0];
    if (!p) return;
    const price = parseFloat(p.priceUsd) || 0;
    const change = p.priceChange?.h1 || 0;
    const up = change >= 0;
    const priceEl = document.getElementById('live-price');
    priceEl.textContent = fmtPrice(price);
    priceEl.className = up ? 'up' : 'down';
    const changeEl = document.getElementById('price-change');
    changeEl.textContent = (up ? '+' : '') + change.toFixed(2) + '%';
    changeEl.className = up ? 'up' : 'down';
    document.getElementById('stat-vol').textContent = fmtUsd(p.volume?.h24 || 0);
    document.getElementById('stat-mcap').textContent = fmtUsd(p.marketCap || p.fdv || 0);
    document.getElementById('stat-liq').textContent = fmtUsd(p.liquidity?.usd || 0);
    const tx = p.txns?.h1;
    if (tx) document.getElementById('stat-txns').innerHTML = `<span style="color:var(--green)">${tx.buys}</span>/<span style="color:var(--red)">${tx.sells}</span>`;
  } catch (e) { console.warn('DexScreener error:', e); }
}

async function fetchTokenIcon() {
  try {
    const r = await fetch('https://frontend-api-v3.pump.fun/coins/' + MINT);
    if (r.ok) { const d = await r.json(); document.getElementById('token-icon').src = d.image_uri || ''; }
  } catch {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Timeframe switching
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.ctrl-btn[data-tf]').forEach(btn => {
  btn.addEventListener('click', async () => {
    document.querySelectorAll('.ctrl-btn[data-tf]').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    await loadTimeframe(btn.dataset.type, parseInt(btn.dataset.tf));
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Init
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tweet Feed Panel
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let feedOpen = false;
let widgetsLoaded = false;

function toggleFeed() {
  feedOpen = !feedOpen;
  const panel = document.getElementById('feed-panel');
  const btn = document.getElementById('feed-toggle-btn');
  panel.classList.toggle('open', feedOpen);
  btn.classList.toggle('active', feedOpen);

  // Load Twitter widgets.js on first open (no API key needed)
  if (feedOpen && !widgetsLoaded) {
    widgetsLoaded = true;
    const s = document.createElement('script');
    s.src = 'https://platform.twitter.com/widgets.js';
    s.async = true;
    s.charset = 'utf-8';
    document.head.appendChild(s);
  } else if (feedOpen && window.twttr?.widgets) {
    // Re-render if already loaded
    window.twttr.widgets.load(document.getElementById('feed-body'));
  }

  // Resize chart to make room
  setTimeout(() => {
    const w = feedOpen ? window.innerWidth - 380 : window.innerWidth;
    const area = document.getElementById('chart-area');
    const container = document.getElementById('chart-container');
    area.style.width = w + 'px';
    container.style.width = w + 'px';
    chart.resize(w, window.innerHeight - 48);
    requestAnimationFrame(() => requestAnimationFrame(drawMarkers));
  }, 300);
}

(async function init() {
  initChart();
  await Promise.all([fetchTokenIcon(), fetchDexStats()]);
  await loadTimeframe('minute', 1);
  setInterval(fetchDexStats, 10000);
  setInterval(() => loadTimeframe(currentTf.type, currentTf.agg), 30000);
})();
</script>
</body>
</html>
